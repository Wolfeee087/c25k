<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="C25K">
<meta name="theme-color" content="#08080e">
<title>C25K â€” Couch to 5K</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#08080e;--s1:#111119;--s2:#1a1a26;--s3:#222233;--brd:#2a2a3d;
  --t:#eeeef4;--td:#7c7c9a;--tm:#a0a0bc;
  --run:#ff4d2a;--runs:#ff4d2a20;--rung:#ff4d2a50;
  --walk:#00ccff;--walks:#00ccff20;--walkg:#00ccff50;
  --warm:#ffb020;--warms:#ffb02020;--warmg:#ffb02050;
  --cool:#9955ff;--cools:#9955ff20;--coolg:#9955ff50;
  --done:#00e676;--dones:#00e67620;--doneg:#00e67650;
  --gold:#ffd740;
  --r:14px;--rs:10px;
  --sat:env(safe-area-inset-top);
  --sab:env(safe-area-inset-bottom)
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html{touch-action:manipulation}
body{font-family:'Outfit',sans-serif;background:var(--bg);color:var(--t);min-height:100dvh;overflow-x:hidden;-webkit-font-smoothing:antialiased}
.app{max-width:460px;margin:0 auto;padding:0 16px;min-height:100dvh;display:flex;flex-direction:column;padding-bottom:calc(62px + var(--sab))}

/* Header */
.hdr{padding:calc(12px + var(--sat)) 0 6px;display:flex;align-items:center;justify-content:space-between}
.hdr-l .logo{font-size:10px;font-weight:700;letter-spacing:3.5px;text-transform:uppercase;color:var(--td)}
.hdr-l h1{font-size:26px;font-weight:900;letter-spacing:-1px;background:linear-gradient(135deg,var(--run),var(--walk));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.hdr-r{display:flex;gap:7px}
.ib{width:36px;height:36px;border-radius:10px;border:1.5px solid var(--brd);background:var(--s1);color:var(--td);font-size:14px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s}
.ib.on{border-color:var(--run);color:var(--run);background:var(--runs)}
.ib:active{transform:scale(.9)}

/* Streak banner */
.streak-bar{display:flex;align-items:center;gap:7px;padding:7px 12px;background:var(--s1);border:1px solid var(--brd);border-radius:var(--rs);margin-bottom:10px;font-size:12px}
.streak-bar .flame{font-size:16px}
.streak-bar .streak-num{font-family:'JetBrains Mono',monospace;font-weight:700;color:var(--warm)}
.streak-bar .streak-txt{color:var(--td)}
.streak-bar .xp-badge{margin-left:auto;font-family:'JetBrains Mono',monospace;font-size:11px;font-weight:700;color:var(--walk);background:var(--walks);padding:3px 9px;border-radius:20px}

/* Bottom Nav */
.bnav{position:fixed;bottom:0;left:0;right:0;background:var(--s1);border-top:1px solid var(--brd);display:flex;justify-content:center;z-index:50;padding-bottom:var(--sab)}
.bnav-inner{display:flex;max-width:460px;width:100%}
.bnav button{flex:1;padding:8px 0 6px;border:none;background:transparent;color:var(--td);font-family:inherit;font-size:10px;font-weight:600;cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:2px;transition:all .2s}
.bnav button .ni{font-size:18px;line-height:1}
.bnav button.on{color:var(--run)}
.bnav button.on .ni{transform:scale(1.1)}

/* Screens */
.scr{display:none;flex:1;flex-direction:column;overflow-y:auto;-webkit-overflow-scrolling:touch}.scr.on{display:flex}

/* Plan */
.wscrl{display:flex;gap:5px;overflow-x:auto;padding:2px 0 10px;scrollbar-width:none;scroll-behavior:smooth}.wscrl::-webkit-scrollbar{display:none}
.wk{flex-shrink:0;width:40px;height:40px;border-radius:10px;border:2px solid var(--brd);background:var(--s1);color:var(--td);font-family:inherit;font-size:13px;font-weight:700;cursor:pointer;transition:all .2s;position:relative}
.wk.on{border-color:var(--run);color:var(--t);background:var(--runs);box-shadow:0 0 12px var(--rung)}
.wk.dn{border-color:var(--done);color:var(--done)}
.wk.dn::after{content:'âœ“';position:absolute;top:-5px;right:-4px;font-size:9px;background:var(--done);color:var(--bg);width:14px;height:14px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:800}
.dcds{display:flex;flex-direction:column;gap:9px;padding-bottom:16px}
.dc{background:var(--s1);border:1px solid var(--brd);border-radius:var(--r);padding:14px;cursor:pointer;transition:all .15s;position:relative;overflow:hidden}
.dc:active{transform:scale(.985);background:var(--s2)}
.dc.cd{border-color:var(--done);opacity:.6}
.dc.cd::before{content:'COMPLETED';position:absolute;top:10px;right:12px;font-size:9px;font-weight:800;color:var(--done);letter-spacing:1.5px}
.dc .dt{font-size:16px;font-weight:700;margin-bottom:2px}
.dc .ds{font-size:11px;color:var(--td);margin-bottom:7px;line-height:1.5}
.dc .dd{display:flex;gap:12px;font-family:'JetBrains Mono',monospace;font-size:11px;font-weight:500}
.dc .dd span{display:flex;align-items:center;gap:4px}
.dc .dd .rv{color:var(--run)}.dc .dd .wv{color:var(--walk)}.dc .dd .tv{color:var(--tm)}
.ivp{display:flex;gap:2px;margin-top:8px;height:4px;border-radius:3px;overflow:hidden}
.ivb{border-radius:3px}.ivb.warmup{background:var(--warm)}.ivb.run{background:var(--run)}.ivb.walk{background:var(--walk)}.ivb.cooldown{background:var(--cool)}
.repeat-btn{margin-top:6px;padding:10px;border:1.5px dashed var(--brd);border-radius:var(--rs);background:transparent;color:var(--td);font-family:inherit;font-size:12px;font-weight:600;cursor:pointer;width:100%;text-align:center;transition:all .2s}
.repeat-btn:active{border-color:var(--walk);color:var(--walk)}

/* Timer - optimized for iPhone XS 812pt */
.tscr{align-items:center;justify-content:space-between;padding:4px 0 10px;gap:0}
.t-top{text-align:center}
.twk{font-size:11px;font-weight:600;color:var(--td);letter-spacing:2.5px;text-transform:uppercase;margin-bottom:4px}
.tph{font-size:40px;font-weight:900;letter-spacing:-1.5px;text-transform:uppercase;transition:color .3s;line-height:1.1}
.tph.run{color:var(--run)}.tph.walk{color:var(--walk)}.tph.warmup{color:var(--warm)}.tph.cooldown{color:var(--cool)}.tph.done{color:var(--done)}.tph.ready{color:var(--tm)}
.tco{font-size:12px;color:var(--td);margin-top:2px;min-height:18px;font-style:italic}

.t-mid{display:flex;flex-direction:column;align-items:center;gap:10px}
.rw{position:relative;width:180px;height:180px}
.rw svg{width:100%;height:100%;transform:rotate(-90deg)}
.rbg{fill:none;stroke:var(--s2);stroke-width:7}
.rfg{fill:none;stroke-width:7;stroke-linecap:round;transition:stroke .3s}
.rc{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center}
.rc .rtm{font-family:'JetBrains Mono',monospace;font-size:42px;font-weight:700;letter-spacing:-2px}
.rc .rnx{font-size:11px;color:var(--td);margin-top:1px}

.lss{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;width:100%;max-width:320px}
.ls{background:var(--s1);border:1px solid var(--brd);border-radius:var(--rs);padding:7px 4px;text-align:center}
.ls .lv{font-family:'JetBrains Mono',monospace;font-size:15px;font-weight:700}
.ls .ll{font-size:8px;color:var(--td);text-transform:uppercase;letter-spacing:.5px;margin-top:1px}
.ls .lv.cal{color:var(--warm)}.ls .lv.pace{color:var(--walk)}.ls .lv.dist{color:var(--done)}

.tpb{width:100%;max-width:320px}
.tpb-t{display:flex;justify-content:space-between;font-size:10px;color:var(--td);margin-bottom:3px;font-family:'JetBrains Mono',monospace}
.tpb-b{height:3px;background:var(--s2);border-radius:2px;overflow:hidden}
.tpb-f{height:100%;border-radius:2px;background:linear-gradient(90deg,var(--run),var(--walk));transition:width .3s}

.t-bot{display:flex;flex-direction:column;align-items:center;gap:10px;width:100%}
.tctl{display:flex;gap:14px;align-items:center}
.bp{width:60px;height:60px;border-radius:50%;border:none;color:#fff;font-size:22px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s}
.bp.ready{background:var(--done);box-shadow:0 4px 18px var(--doneg)}
.bp.playing{background:var(--walk);box-shadow:0 4px 18px var(--walkg)}
.bp:active{transform:scale(.9)}
.bs{width:40px;height:40px;border-radius:50%;border:1.5px solid var(--brd);background:var(--s1);color:var(--td);font-size:15px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s}
.bs:active{transform:scale(.9)}

/* Post-run summary overlay */
.summary-overlay{display:none;position:fixed;inset:0;background:var(--bg);z-index:200;flex-direction:column;align-items:center;justify-content:center;padding:20px;padding-top:calc(20px + var(--sat));padding-bottom:calc(20px + var(--sab));overflow-y:auto}
.summary-overlay.open{display:flex}
.sum-title{font-size:13px;font-weight:700;color:var(--td);letter-spacing:3px;text-transform:uppercase;margin-bottom:4px}
.sum-big{font-size:42px;font-weight:900;margin-bottom:4px;background:linear-gradient(135deg,var(--done),var(--walk));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.sum-sub{font-size:13px;color:var(--td);margin-bottom:20px;text-align:center;padding:0 10px}
.sum-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;width:100%;max-width:320px;margin-bottom:16px}
.sum-card{background:var(--s1);border:1px solid var(--brd);border-radius:var(--r);padding:14px;text-align:center}
.sum-card .sv{font-family:'JetBrains Mono',monospace;font-size:22px;font-weight:700}
.sum-card .sl{font-size:10px;color:var(--td);margin-top:2px;text-transform:uppercase;letter-spacing:1px}
.sum-xp{font-family:'JetBrains Mono',monospace;font-size:16px;font-weight:700;color:var(--walk);background:var(--walks);padding:7px 20px;border-radius:30px;margin-bottom:10px}
.sum-badge{background:var(--s1);border:1px solid var(--gold);border-radius:var(--r);padding:12px 16px;display:flex;align-items:center;gap:10px;margin-bottom:10px;width:100%;max-width:320px}
.sum-badge .badge-icon{font-size:26px}
.sum-badge .badge-info .badge-name{font-size:13px;font-weight:700;color:var(--gold)}
.sum-badge .badge-info .badge-desc{font-size:10px;color:var(--td);margin-top:2px}
.sum-btn{width:100%;max-width:320px;padding:14px;border:none;border-radius:var(--r);background:linear-gradient(135deg,var(--done),#18b85c);color:var(--bg);font-family:inherit;font-size:14px;font-weight:800;letter-spacing:1px;text-transform:uppercase;cursor:pointer;margin-top:6px;transition:all .2s}
.sum-btn:active{transform:scale(.97)}

/* Progress */
.pscr{padding-bottom:16px}
.srow{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-bottom:12px}
.sc{background:var(--s1);border:1px solid var(--brd);border-radius:var(--r);padding:12px;text-align:center}
.sc .sv{font-family:'JetBrains Mono',monospace;font-size:22px;font-weight:700;color:var(--run)}
.sc .sl{font-size:9px;color:var(--td);margin-top:2px;text-transform:uppercase;letter-spacing:1px}

/* Level bar */
.lvl-bar{background:var(--s1);border:1px solid var(--brd);border-radius:var(--r);padding:12px;margin-bottom:12px;display:flex;align-items:center;gap:10px}
.lvl-icon{font-size:28px}
.lvl-info{flex:1;min-width:0}
.lvl-info .lvl-name{font-size:14px;font-weight:700}
.lvl-info .lvl-sub{font-size:10px;color:var(--td);margin-top:1px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.lvl-info .lvl-track{height:5px;background:var(--s2);border-radius:3px;margin-top:5px;overflow:hidden}
.lvl-info .lvl-fill{height:100%;border-radius:3px;background:linear-gradient(90deg,var(--walk),var(--run));transition:width .5s}
.lvl-xp{font-family:'JetBrains Mono',monospace;font-size:13px;font-weight:700;color:var(--walk);flex-shrink:0}

/* Progress grid - 7 cols fits iPhone XS better */
.pgrid{display:grid;grid-template-columns:repeat(7,1fr);gap:3px;margin-bottom:14px}
.pc{aspect-ratio:.8;border-radius:5px;border:1.5px solid var(--brd);background:var(--s1);display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:8px;color:var(--td);gap:1px}
.pc .pw{font-weight:700;font-size:7px;letter-spacing:.3px}.pc .pd{font-size:10px;font-weight:800}
.pc.dn{border-color:var(--done);background:var(--dones);color:var(--done)}

/* Badges section */
.badges-title{font-size:12px;font-weight:700;color:var(--tm);letter-spacing:1px;text-transform:uppercase;margin-bottom:7px}
.badges-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:7px;margin-bottom:14px}
.badge-cell{aspect-ratio:1;border-radius:var(--rs);border:1.5px solid var(--brd);background:var(--s1);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:2px;font-size:8px;color:var(--td);transition:all .3s}
.badge-cell.earned{border-color:var(--gold);background:#ffd74012;color:var(--gold)}
.badge-cell .be{font-size:20px}.badge-cell .bn{text-align:center;line-height:1.2}

.htitle{font-size:12px;font-weight:700;color:var(--tm);margin-bottom:7px;letter-spacing:1px;text-transform:uppercase}
.hlist{display:flex;flex-direction:column;gap:4px;margin-bottom:14px}
.hi{display:flex;justify-content:space-between;align-items:center;background:var(--s1);border:1px solid var(--brd);border-radius:var(--rs);padding:10px 12px;font-size:11px}
.hi .hl{color:var(--t);min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex:1;margin-right:8px}
.hi .hr{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--td);display:flex;gap:7px;flex-shrink:0}
.hi .hr span{display:flex;align-items:center;gap:3px}

.rbtn{width:100%;padding:11px;border:1.5px solid var(--brd);border-radius:var(--r);background:transparent;color:var(--td);font-family:inherit;font-size:12px;font-weight:600;cursor:pointer;margin-top:6px;transition:all .2s}
.rbtn:active{border-color:var(--run);color:var(--run)}

/* Body/Weight tracker */
.bscr{padding-bottom:16px}
.wt-input{display:flex;gap:7px;margin-bottom:14px}
.wt-input input{flex:1;padding:11px;background:var(--s2);border:1.5px solid var(--brd);border-radius:var(--rs);color:var(--t);font-family:inherit;font-size:15px;font-weight:500;outline:none;-webkit-appearance:none}
.wt-input input:focus{border-color:var(--walk)}
.wt-input button{padding:11px 18px;border:none;border-radius:var(--rs);background:var(--run);color:#fff;font-family:inherit;font-size:13px;font-weight:700;cursor:pointer}
.wt-input button:active{transform:scale(.95)}
.wt-chart{background:var(--s1);border:1px solid var(--brd);border-radius:var(--r);padding:14px;margin-bottom:12px;min-height:170px;position:relative}
.wt-chart canvas{width:100%;height:150px}
.wt-chart .no-data{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;color:var(--td);font-size:12px}
.wt-summary{display:grid;grid-template-columns:repeat(3,1fr);gap:7px;margin-bottom:14px}
.wt-summary .ws{background:var(--s1);border:1px solid var(--brd);border-radius:var(--rs);padding:10px;text-align:center}
.wt-summary .ws .wsv{font-family:'JetBrains Mono',monospace;font-size:18px;font-weight:700}
.wt-summary .ws .wsl{font-size:8px;color:var(--td);text-transform:uppercase;letter-spacing:.5px;margin-top:2px}
.wt-log{display:flex;flex-direction:column;gap:4px}
.wt-entry{display:flex;justify-content:space-between;align-items:center;background:var(--s1);border:1px solid var(--brd);border-radius:var(--rs);padding:9px 12px;font-size:11px}
.wt-entry .we-date{color:var(--td)}.wt-entry .we-val{font-family:'JetBrains Mono',monospace;font-weight:700}
.wt-entry .we-del{background:none;border:none;color:var(--td);font-size:13px;cursor:pointer;padding:0 4px}

/* Quote */
.quote-box{background:var(--s1);border:1px solid var(--brd);border-radius:var(--r);padding:12px 14px;margin-bottom:12px;font-style:italic;font-size:12px;color:var(--tm);line-height:1.5;text-align:center}
.quote-box .qa{display:block;margin-top:3px;font-style:normal;font-size:10px;color:var(--td)}

/* Settings Modal */
.mo{display:none;position:fixed;inset:0;background:#000a;z-index:100;align-items:flex-end;justify-content:center}
.mo.open{display:flex}
.mod{background:var(--s1);border-radius:20px 20px 0 0;padding:22px 18px calc(30px + var(--sab));width:100%;max-width:460px;max-height:70vh;overflow-y:auto}
.mod h2{font-size:17px;font-weight:800;margin-bottom:14px}
.mod-x{float:right;background:none;border:none;color:var(--td);font-size:20px;cursor:pointer;padding:4px}
.fld{margin-bottom:12px}
.fld label{display:block;font-size:10px;font-weight:600;color:var(--td);text-transform:uppercase;letter-spacing:1px;margin-bottom:4px}
.fld input,.fld select{width:100%;padding:10px;background:var(--s2);border:1.5px solid var(--brd);border-radius:var(--rs);color:var(--t);font-family:inherit;font-size:14px;font-weight:500;outline:none;-webkit-appearance:none}
.fld input:focus,.fld select:focus{border-color:var(--walk)}
.fld .ht{font-size:9px;color:var(--td);margin-top:3px}
.sbtn{width:100%;padding:12px;border:none;border-radius:var(--r);background:var(--run);color:#fff;font-family:inherit;font-size:14px;font-weight:700;cursor:pointer;margin-top:6px}
.sbtn:active{transform:scale(.97)}

/* Confetti canvas */
#confetti{position:fixed;inset:0;pointer-events:none;z-index:300}

@keyframes fadeUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.fu{animation:fadeUp .35s ease forwards}
@keyframes popIn{from{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}
.pop{animation:popIn .4s cubic-bezier(.17,.67,.35,1.3) forwards}

/* iPhone SE / very small screens */
@media(max-height:700px){
  .rw{width:150px;height:150px}
  .rc .rtm{font-size:36px}
  .tph{font-size:34px}
  .lss{gap:4px}
  .ls{padding:5px 3px}
  .ls .lv{font-size:13px}
}
</style>
</head>
<body>
<canvas id="confetti"></canvas>
<div class="app">
  <div class="hdr">
    <div class="hdr-l"><div class="logo">Couch to</div><h1>5K</h1></div>
    <div class="hdr-r">
      <button class="ib" id="voice-btn" onclick="toggleVoice()" title="Voice">ğŸ—£</button>
      <button class="ib" onclick="openSettings()" title="Settings">âš™</button>
    </div>
  </div>

  <div class="streak-bar" id="streak-bar">
    <span class="flame">ğŸ”¥</span>
    <span class="streak-num" id="streak-num">0</span>
    <span class="streak-txt">week streak</span>
    <span class="xp-badge" id="xp-total">0 XP</span>
  </div>

  <!-- PLAN -->
  <div id="plan-scr" class="scr on">
    <div id="quote-box" class="quote-box"></div>
    <div class="wscrl" id="wsel"></div>
    <div class="dcds" id="dcds"></div>
    <button class="repeat-btn" id="repeat-btn" onclick="repeatWeek()">â†» Repeat this week</button>
  </div>

  <!-- TIMER -->
  <div id="timer-scr" class="scr tscr">
    <div class="t-top">
      <div class="twk" id="t-label">Week 1 Â· Day 1</div>
      <div class="tph ready" id="t-phase">Ready</div>
      <div class="tco" id="t-coach">Tap play to start</div>
    </div>
    <div class="t-mid">
      <div class="rw">
        <svg viewBox="0 0 200 200"><circle class="rbg" cx="100" cy="100" r="88"/><circle class="rfg" id="ring" cx="100" cy="100" r="88" stroke-dasharray="553" stroke-dashoffset="553"/></svg>
        <div class="rc"><div class="rtm" id="t-time">0:00</div><div class="rnx" id="t-next"></div></div>
      </div>
      <div class="lss">
        <div class="ls"><div class="lv cal" id="ls-cal">0</div><div class="ll" id="ll-cal">kcal</div></div>
        <div class="ls"><div class="lv pace" id="ls-pace">--</div><div class="ll" id="ll-pace">min/km</div></div>
        <div class="ls"><div class="lv dist" id="ls-dist">0.00</div><div class="ll" id="ll-dist">km</div></div>
      </div>
      <div class="tpb">
        <div class="tpb-t"><span id="tp-el">0:00</span><span id="tp-tot">0:00</span></div>
        <div class="tpb-b"><div class="tpb-f" id="tp-fill" style="width:0%"></div></div>
      </div>
    </div>
    <div class="t-bot">
      <div class="tctl">
        <button class="bs" onclick="resetTimer()">â†º</button>
        <button class="bp ready" id="btn-play" onclick="handlePlay()">â–¶</button>
        <button class="bs" onclick="skipInterval()">â­</button>
      </div>
    </div>
  </div>

  <!-- PROGRESS -->
  <div id="progress-scr" class="scr pscr"></div>

  <!-- BODY -->
  <div id="body-scr" class="scr bscr">
    <div style="font-size:16px;font-weight:800;margin-bottom:12px">Weight Tracker</div>
    <div class="wt-input">
      <input type="number" id="wt-in" placeholder="Enter weight (kg)" step="0.1" min="20" max="300">
      <button onclick="logWeight()">Log</button>
    </div>
    <div class="wt-chart"><canvas id="wt-canvas"></canvas><div class="no-data" id="wt-nodata">Log your first weigh-in above</div></div>
    <div class="wt-summary" id="wt-summary"></div>
    <div class="htitle" id="wt-log-title" style="display:none">Recent Entries</div>
    <div class="wt-log" id="wt-log"></div>
  </div>

  <!-- Bottom Nav -->
  <nav class="bnav"><div class="bnav-inner">
    <button class="on" onclick="go('plan')"><span class="ni">ğŸ“‹</span>Plan</button>
    <button onclick="go('timer')"><span class="ni">â–¶ï¸</span>Run</button>
    <button onclick="go('progress')"><span class="ni">ğŸ“Š</span>Stats</button>
    <button onclick="go('body')"><span class="ni">âš–ï¸</span>Body</button>
  </div></nav>
</div>

<!-- Post-run summary -->
<div class="summary-overlay" id="sum-overlay">
  <div class="sum-title" id="sum-wk"></div>
  <div class="sum-big">COMPLETE!</div>
  <div class="sum-sub" id="sum-quote"></div>
  <div class="sum-grid" id="sum-grid"></div>
  <div class="sum-xp" id="sum-xp">+0 XP</div>
  <div id="sum-badges"></div>
  <button class="sum-btn" onclick="closeSummary()">Continue</button>
</div>

<!-- Settings -->
<div class="mo" id="set-mo" onclick="if(event.target===this)closeSettings()">
  <div class="mod">
    <button class="mod-x" onclick="closeSettings()">âœ•</button>
    <h2>Settings</h2>
    <div class="fld"><label>Weight (kg)</label><input type="number" id="s-wt" placeholder="70" min="30" max="250"><div class="ht">Used for calorie estimation</div></div>
    <div class="fld"><label>Units</label><select id="s-un"><option value="km">Kilometers</option><option value="mi">Miles</option></select></div>
    <div class="fld"><label>Voice Coach</label><select id="s-vc"><option value="full">Full coaching</option><option value="simple">Simple announcements</option><option value="off">Off</option></select></div>
    <button class="sbtn" onclick="saveSettings()">Save Settings</button>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PROGRAM DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function bp(a,b,n){var r=[];for(var i=0;i<n;i++){r.push(['run',a],['walk',b]);}return r;}
function bi(w,ivs,c){var r=[['warmup',w]];for(var i=0;i<ivs.length;i++)r.push(ivs[i]);r.push(['cooldown',c]);return r;}

var P=[
  [bi(300,bp(60,90,8),300),bi(300,bp(60,90,8),300),bi(300,bp(60,90,8),300)],
  [bi(300,bp(90,120,6),300),bi(300,bp(90,120,6),300),bi(300,bp(90,120,6),300)],
  [bi(300,[['run',90],['walk',90],['run',180],['walk',180],['run',90],['walk',90],['run',180],['walk',180]],300),bi(300,[['run',90],['walk',90],['run',180],['walk',180],['run',90],['walk',90],['run',180],['walk',180]],300),bi(300,[['run',90],['walk',90],['run',180],['walk',180],['run',90],['walk',90],['run',180],['walk',180]],300)],
  [bi(300,[['run',180],['walk',90],['run',300],['walk',150],['run',180],['walk',90],['run',300]],300),bi(300,[['run',180],['walk',90],['run',300],['walk',150],['run',180],['walk',90],['run',300]],300),bi(300,[['run',180],['walk',90],['run',300],['walk',150],['run',180],['walk',90],['run',300]],300)],
  [bi(300,[['run',300],['walk',180],['run',300],['walk',180],['run',300]],300),bi(300,[['run',480],['walk',300],['run',480]],300),bi(300,[['run',1200]],300)],
  [bi(300,[['run',300],['walk',180],['run',480],['walk',180],['run',300]],300),bi(300,[['run',600],['walk',180],['run',600]],300),bi(300,[['run',1500]],300)],
  [bi(300,[['run',1500]],300),bi(300,[['run',1500]],300),bi(300,[['run',1500]],300)],
  [bi(300,[['run',1680]],300),bi(300,[['run',1680]],300),bi(300,[['run',1680]],300)],
  [bi(300,[['run',1800]],300),bi(300,[['run',1800]],300),bi(300,[['run',1800]],300)]
];
var NM=[
  ["Walk + 1min run Ã—8","Walk + 1min run Ã—8","Walk + 1min run Ã—8"],
  ["1.5min run Ã—6","1.5min run Ã—6","1.5min run Ã—6"],
  ["Mixed 1.5 & 3min runs","Mixed 1.5 & 3min runs","Mixed 1.5 & 3min runs"],
  ["3 & 5min run blocks","3 & 5min run blocks","3 & 5min run blocks"],
  ["Three 5min runs","Two 8min runs","20 minute run!"],
  ["5, 8 & 5min runs","Two 10min runs","25 minute run"],
  ["25 minute run","25 minute run","25 minute run"],
  ["28 minute run","28 minute run","28 minute run"],
  ["30 min run ğŸ","30 min run ğŸ","30 min â€” YOU DID IT! ğŸ‰"]
];
var COACH={
  run:["Let's go! Start running!","Time to run! You've got this!","Run! Pick up the pace!","Here we go, run!","Push it! Running now!"],
  walk:["Nice work! Walk it out.","Great job, take a breather.","Walking break, you earned it.","Ease up, walk now."],
  warmup:["Let's warm up with a brisk walk.","Warm-up time, get moving!"],
  cooldown:["Almost done! Cool down walk.","Great work! Cool down now."],
  done:["Workout complete! Amazing effort!","You did it! Incredible!"],
  halfway:["Halfway there! Keep pushing!","Half done! You're killing it!"],
  tips:{run:"Keep shoulders relaxed, breathe steady.",walk:"Deep breaths, shake out your arms.",warmup:"Start slow, build your pace.",cooldown:"Gradually slow down. Well done."}
};
var QUOTES=[
  {q:"The miracle isn't that I finished. The miracle is that I had the courage to start.",a:"John Bingham"},
  {q:"A journey of a thousand miles begins with a single step.",a:"Lao Tzu"},
  {q:"You don't have to be great to start, but you have to start to be great.",a:"Zig Ziglar"},
  {q:"The only bad workout is the one that didn't happen.",a:"Unknown"},
  {q:"It does not matter how slowly you go as long as you do not stop.",a:"Confucius"},
  {q:"Your body can stand almost anything. It's your mind you have to convince.",a:"Unknown"},
  {q:"Believe you can and you're halfway there.",a:"Theodore Roosevelt"},
  {q:"Success is the sum of small efforts repeated day in and day out.",a:"Robert Collier"},
  {q:"The hard days are the best because that's when champions are made.",a:"Gabby Douglas"},
  {q:"Run when you can, walk if you have to, crawl if you must; just never give up.",a:"Dean Karnazes"}
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ACHIEVEMENTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var BADGES=[
  {id:'first',icon:'ğŸŒŸ',name:'First Step',desc:'Complete your first workout',check:function(s){return s.total>=1}},
  {id:'w1',icon:'1ï¸âƒ£',name:'Week 1',desc:'Complete Week 1',check:function(s){return s.weeks[0]}},
  {id:'w3',icon:'3ï¸âƒ£',name:'Week 3',desc:'Complete Week 3',check:function(s){return s.weeks[2]}},
  {id:'w5',icon:'5ï¸âƒ£',name:'Halfway',desc:'Complete Week 5',check:function(s){return s.weeks[4]}},
  {id:'w9',icon:'ğŸ†',name:'Graduate',desc:'Complete Week 9',check:function(s){return s.weeks[8]}},
  {id:'streak3',icon:'ğŸ”¥',name:'On Fire',desc:'3 week streak',check:function(s){return s.streak>=3}},
  {id:'streak6',icon:'ğŸ’',name:'Unstoppable',desc:'6 week streak',check:function(s){return s.streak>=6}},
  {id:'cal500',icon:'âš¡',name:'Burner',desc:'Burn 500+ total kcal',check:function(s){return s.cals>=500}},
  {id:'cal2000',icon:'ğŸ”‹',name:'Furnace',desc:'Burn 2000+ total kcal',check:function(s){return s.cals>=2000}},
  {id:'dist5',icon:'ğŸ—ºï¸',name:'Explorer',desc:'Run 5+ total km',check:function(s){return s.dist>=5}},
  {id:'dist25',icon:'ğŸŒ',name:'Voyager',desc:'Run 25+ total km',check:function(s){return s.dist>=25}},
  {id:'ten',icon:'ğŸ”Ÿ',name:'Double Digits',desc:'Complete 10 workouts',check:function(s){return s.total>=10}}
];

// LEVELS
var LEVELS=[
  {name:'Couch Potato',xp:0,icon:'ğŸ›‹ï¸'},
  {name:'First Timer',xp:100,icon:'ğŸ‘Ÿ'},
  {name:'Getting Started',xp:300,icon:'ğŸš¶'},
  {name:'Jogger',xp:600,icon:'ğŸƒ'},
  {name:'Runner',xp:1000,icon:'ğŸ’¨'},
  {name:'Athlete',xp:1600,icon:'âš¡'},
  {name:'Champion',xp:2400,icon:'ğŸ…'},
  {name:'Legend',xp:3500,icon:'ğŸ†'},
  {name:'Unstoppable',xp:5000,icon:'ğŸ‘‘'}
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var selW=0,curWO=null,ivs=[],curIv=0,secLeft=0,totEl=0;
var isRun=false,tH=null,audioCtx=null;
var voiceOn=true,voiceMode='full';
var geoW=null,lastP=null,tDist=0,lastPT=0,cPace='--';
var sCals=0,halfSp=false;
var wakeLock=null;
var lastTickTime=0; // FIX: track real time for background recovery

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STORAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function sg(k,d){try{var v=localStorage.getItem('c25k_'+k);return v!==null?JSON.parse(v):d}catch(e){return d}}
function ss(k,v){try{localStorage.setItem('c25k_'+k,JSON.stringify(v))}catch(e){}}
function isDn(w,d){return sg('prog',{})[w+'-'+d]!=null}
function wkDn(w){return isDn(w,0)&&isDn(w,1)&&isDn(w,2)}
function gSet(){return sg('settings',{weight:70,units:'km',voice:'full'})}
function gXP(){return sg('xp',0)}
function gBadges(){return sg('badges',[])}

function getStats(){
  var p=sg('prog',{});var total=0,cals=0,dist=0,weeks=[];
  for(var w=0;w<9;w++){
    var wd=true;
    for(var d=0;d<3;d++){
      var k=w+'-'+d;
      if(p[k]!=null){total++;if(p[k].cal)cals+=p[k].cal;if(p[k].dist)dist+=p[k].dist;}
      else wd=false;
    }
    weeks.push(wd);
  }
  return{total:total,cals:cals,dist:dist,weeks:weeks,streak:calcStreak()};
}

function calcStreak(){
  var s=0;
  for(var w=0;w<9;w++){if(wkDn(w))s++;else break;}
  return s;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// WAKE LOCK (keeps screen on during workout)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function requestWakeLock(){
  try{
    if('wakeLock' in navigator){
      wakeLock=await navigator.wakeLock.request('screen');
      wakeLock.addEventListener('release',function(){wakeLock=null;});
    }
  }catch(e){}
}
function releaseWakeLock(){
  try{if(wakeLock){wakeLock.release();wakeLock=null;}}catch(e){}
}
// Re-acquire wake lock when page becomes visible again
document.addEventListener('visibilitychange',function(){
  if(document.visibilityState==='visible'&&isRun){
    requestWakeLock();
    // FIX: recover lost time when returning from background
    recoverLostTime();
  }
});

function recoverLostTime(){
  if(!isRun||!lastTickTime||curIv>=ivs.length)return;
  var now=Date.now();
  var elapsed=Math.round((now-lastTickTime)/1000);
  if(elapsed<=1)return; // no time lost
  // Fast-forward the timer by the missed seconds
  for(var i=0;i<elapsed&&curIv<ivs.length;i++){
    secLeft--;totEl++;
    if(secLeft<=0){
      curIv++;
      if(curIv<ivs.length){
        secLeft=ivs[curIv][1];
      }else{
        // Workout finished while backgrounded
        if(tH){clearInterval(tH);tH=null;}
        isRun=false;halfSp=false;stopGPS();releaseWakeLock();
        snd('done');vPhase('done');
        document.getElementById('t-coach').textContent="You're a champion! ğŸ†";
        showSummary();
        refreshTimer();
        return;
      }
    }
  }
  lastTickTime=now;
  refreshTimer();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUDIO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initA(){try{if(!audioCtx)audioCtx=new(window.AudioContext||window.webkitAudioContext)();if(audioCtx.state==='suspended')audioCtx.resume();}catch(e){}}
function beep(f,dur,n){try{initA();if(!audioCtx)return;var t=audioCtx.currentTime;for(var i=0;i<n;i++){var o=audioCtx.createOscillator(),g=audioCtx.createGain();o.connect(g);g.connect(audioCtx.destination);o.frequency.value=f;o.type='sine';g.gain.setValueAtTime(.25,t);g.gain.exponentialRampToValueAtTime(.01,t+dur);o.start(t);o.stop(t+dur);t+=dur+.12;}}catch(e){}}
function snd(t){try{if(t==='run')beep(880,.12,3);else if(t==='walk')beep(523,.18,2);else if(t==='warmup')beep(660,.18,1);else if(t==='cooldown')beep(440,.25,2);else if(t==='done')beep(1047,.12,5);else if(t==='tick')beep(660,.06,1);}catch(e){}}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VOICE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function speak(text){try{if(!voiceOn||voiceMode==='off'||!window.speechSynthesis)return;window.speechSynthesis.cancel();var u=new SpeechSynthesisUtterance(text);u.rate=1;u.pitch=1;u.volume=1;window.speechSynthesis.speak(u);}catch(e){}}
function vPhase(type){try{var msgs=COACH[type]||[];if(voiceMode==='simple'){var m={run:'Run!',walk:'Walk!',warmup:'Warm up!',cooldown:'Cool down!',done:'Workout complete!'};speak(m[type]||type);}else if(msgs.length>0){speak(msgs[Math.floor(Math.random()*msgs.length)]);}}catch(e){}}
function toggleVoice(){voiceOn=!voiceOn;document.getElementById('voice-btn').classList.toggle('on',voiceOn);}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GPS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function startGPS(){
  try{
    if(!navigator.geolocation)return;
    tDist=0;lastP=null;cPace='--';lastPT=0;
    geoW=navigator.geolocation.watchPosition(function(p){
      if(lastP&&isRun){
        var d=hav(lastP.coords.latitude,lastP.coords.longitude,p.coords.latitude,p.coords.longitude);
        // FIX: filter GPS jitter (min 3m) and outliers (max 500m)
        if(d>0.003&&d<0.5){
          tDist+=d;
        }
      }
      lastP=p;
      if(totEl-lastPT>=10&&tDist>0.01){
        var mpk=totEl/60/tDist;
        if(mpk<30)cPace=mpk.toFixed(1);
        lastPT=totEl;
      }
    },function(){},{enableHighAccuracy:true,maximumAge:3000,timeout:10000});
  }catch(e){}
}
function stopGPS(){try{if(geoW!=null){navigator.geolocation.clearWatch(geoW);geoW=null;}}catch(e){}}
function hav(a1,o1,a2,o2){var R=6371,dLat=(a2-a1)*Math.PI/180,dLon=(o2-o1)*Math.PI/180;var a=Math.sin(dLat/2)*Math.sin(dLat/2)+Math.cos(a1*Math.PI/180)*Math.cos(a2*Math.PI/180)*Math.sin(dLon/2)*Math.sin(dLon/2);return R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CALORIES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function calcCal(){var wt=gSet().weight||70;var met={warmup:3,run:8,walk:3.5,cooldown:3};var cal=0;for(var i=0;i<curIv&&i<ivs.length;i++)cal+=(met[ivs[i][0]]||3)*wt*ivs[i][1]/3600;if(curIv<ivs.length){var el=ivs[curIv][1]-secLeft;cal+=(met[ivs[curIv][0]]||3)*wt*el/3600;}return Math.round(cal);}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FORMATTING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function fmt(s){var m=Math.floor(s/60);var sec=s%60;return m+':'+(sec<10?'0':'')+sec;}
function fmtM(s){var m=Math.floor(s/60);return m<1?s+'s':m+'min';}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFETTI (DPR-aware)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function fireConfetti(){
  var c=document.getElementById('confetti');var ctx=c.getContext('2d');
  var dpr=window.devicePixelRatio||1;
  var W=window.innerWidth,H=window.innerHeight;
  c.width=W*dpr;c.height=H*dpr;
  c.style.width=W+'px';c.style.height=H+'px';
  ctx.scale(dpr,dpr);
  var particles=[];var colors=['#ff4d2a','#00ccff','#ffb020','#00e676','#9955ff','#ffd740'];
  for(var i=0;i<120;i++){particles.push({x:W/2,y:H/2,vx:(Math.random()-.5)*16,vy:Math.random()*-14-4,size:Math.random()*6+3,color:colors[Math.floor(Math.random()*colors.length)],rotation:Math.random()*360,rotSpeed:(Math.random()-.5)*10,life:1});}
  var frame=0;
  function draw(){
    ctx.clearRect(0,0,W,H);
    var alive=false;
    for(var i=0;i<particles.length;i++){
      var p=particles[i];
      p.x+=p.vx;p.y+=p.vy;p.vy+=.3;p.rotation+=p.rotSpeed;p.life-=.008;
      if(p.life>0){alive=true;ctx.save();ctx.translate(p.x,p.y);ctx.rotate(p.rotation*Math.PI/180);ctx.globalAlpha=p.life;ctx.fillStyle=p.color;ctx.fillRect(-p.size/2,-p.size/2,p.size,p.size);ctx.restore();}
    }
    frame++;if(alive&&frame<200)requestAnimationFrame(draw);else ctx.clearRect(0,0,W,H);
  }
  draw();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function go(name){
  var scrs=document.querySelectorAll('.scr');for(var i=0;i<scrs.length;i++)scrs[i].classList.remove('on');
  var btns=document.querySelectorAll('.bnav button');for(var i=0;i<btns.length;i++)btns[i].classList.remove('on');
  document.getElementById(name+'-scr').classList.add('on');
  var idx=['plan','timer','progress','body'].indexOf(name);
  if(idx>=0)btns[idx].classList.add('on');
  if(name==='progress')renderProgress();
  if(name==='body')renderBody();
  if(name==='timer'&&!curWO)autoLoad();
  // Scroll to top when switching tabs
  document.getElementById(name+'-scr').scrollTop=0;
}

function autoLoad(){for(var w=0;w<9;w++)for(var d=0;d<3;d++)if(!isDn(w,d)){loadWO(w,d);return;}loadWO(0,0);}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PLAN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderPlan(){
  // Quote
  var qi=Math.floor(Date.now()/(1000*60*60*12))%QUOTES.length;
  var q=QUOTES[qi];
  document.getElementById('quote-box').innerHTML='"'+q.q+'"<span class="qa">â€” '+q.a+'</span>';

  // Streak
  var st=getStats();
  document.getElementById('streak-num').textContent=st.streak;
  document.getElementById('xp-total').textContent=gXP()+' XP';

  // Weeks
  var sel=document.getElementById('wsel');sel.innerHTML='';
  for(var w=0;w<9;w++){
    var b=document.createElement('button');
    b.className='wk'+(w===selW?' on':'')+(wkDn(w)?' dn':'');
    b.textContent=w+1;
    b.setAttribute('data-w',w);
    b.onclick=function(){selW=parseInt(this.getAttribute('data-w'));renderPlan();};
    sel.appendChild(b);
  }
  // FIX: Auto-scroll to selected week
  setTimeout(function(){
    var activeWk=sel.querySelector('.wk.on');
    if(activeWk){
      activeWk.scrollIntoView({behavior:'smooth',inline:'center',block:'nearest'});
    }
  },50);

  // Days
  var c=document.getElementById('dcds');c.innerHTML='';
  for(var di=0;di<3;di++){
    var day=P[selW][di];var total=0,runT=0,walkT=0;
    for(var j=0;j<day.length;j++){total+=day[j][1];if(day[j][0]==='run')runT+=day[j][1];if(day[j][0]==='walk')walkT+=day[j][1];}
    var done=isDn(selW,di);var cd=document.createElement('div');
    cd.className='dc fu'+(done?' cd':'');cd.style.animationDelay=(di*.07)+'s';
    cd.setAttribute('data-w',selW);cd.setAttribute('data-d',di);
    var bars='';for(var k=0;k<day.length;k++)bars+='<div class="ivb '+day[k][0]+'" style="flex:'+day[k][1]+'"></div>';
    cd.innerHTML='<div class="dt">Day '+(di+1)+'</div><div class="ds">'+NM[selW][di]+'</div><div class="dd"><span class="rv">ğŸƒ '+fmtM(runT)+'</span><span class="wv">ğŸš¶ '+fmtM(walkT)+'</span><span class="tv">â± '+fmt(total)+'</span></div><div class="ivp">'+bars+'</div>';
    cd.onclick=function(){loadWO(parseInt(this.getAttribute('data-w')),parseInt(this.getAttribute('data-d')));go('timer');};
    c.appendChild(cd);
  }

  // Repeat button
  document.getElementById('repeat-btn').style.display=wkDn(selW)?'block':'none';
}

function repeatWeek(){
  var p=sg('prog',{});
  for(var d=0;d<3;d++)delete p[selW+'-'+d];
  ss('prog',p);renderPlan();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TIMER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function loadWO(w,d){
  if(tH){clearInterval(tH);tH=null;}
  isRun=false;halfSp=false;lastTickTime=0;
  releaseWakeLock();
  curWO={week:w,day:d};ivs=P[w][d];curIv=0;totEl=0;
  secLeft=ivs[0][1];sCals=0;tDist=0;cPace='--';
  stopGPS();refreshTimer();
  document.getElementById('t-coach').textContent='Tap play to start';
}

function refreshTimer(){
  if(!curWO)return;
  document.getElementById('t-label').textContent='Week '+(curWO.week+1)+' Â· Day '+(curWO.day+1);
  var ph=(curIv<ivs.length)?ivs[curIv][0]:'done';
  var pe=document.getElementById('t-phase');
  if(ph==='done'){pe.textContent='Done!';pe.className='tph done';}
  else if(!isRun&&totEl===0){pe.textContent='Ready';pe.className='tph ready';}
  else{pe.textContent=ph.charAt(0).toUpperCase()+ph.slice(1);pe.className='tph '+ph;}
  document.getElementById('t-time').textContent=fmt(Math.max(0,secLeft));
  var ne=document.getElementById('t-next');
  if(curIv<ivs.length-1){var nx=ivs[curIv+1];ne.textContent='Next: '+nx[0]+' '+fmtM(nx[1]);}
  else ne.textContent=ph==='done'?'':'Final interval';

  var ring=document.getElementById('ring');
  var iT=(curIv<ivs.length)?ivs[curIv][1]:1;
  ring.setAttribute('stroke-dashoffset',553*(secLeft/iT));
  var cm={run:'var(--run)',walk:'var(--walk)',warmup:'var(--warm)',cooldown:'var(--cool)',done:'var(--done)',ready:'var(--tm)'};
  var gm={run:'var(--rung)',walk:'var(--walkg)',warmup:'var(--warmg)',cooldown:'var(--coolg)',done:'var(--doneg)',ready:'transparent'};
  var dp=(!isRun&&totEl===0)?'ready':ph;
  ring.style.stroke=cm[dp]||cm.ready;ring.style.filter='drop-shadow(0 0 10px '+(gm[dp]||'transparent')+')';

  var tD=0;for(var i=0;i<ivs.length;i++)tD+=ivs[i][1];
  document.getElementById('tp-el').textContent=fmt(totEl);
  document.getElementById('tp-tot').textContent=fmt(tD);
  document.getElementById('tp-fill').style.width=(tD>0?(totEl/tD)*100:0)+'%';

  sCals=calcCal();document.getElementById('ls-cal').textContent=sCals;
  var st=gSet();
  if(st.units==='mi'){
    document.getElementById('ls-pace').textContent=cPace==='--'?'--':(parseFloat(cPace)*1.609).toFixed(1);
    document.getElementById('ll-pace').textContent='min/mi';
    document.getElementById('ls-dist').textContent=(tDist*0.621371).toFixed(2);
    document.getElementById('ll-dist').textContent='mi';
  }else{
    document.getElementById('ls-pace').textContent=cPace;
    document.getElementById('ll-pace').textContent='min/km';
    document.getElementById('ls-dist').textContent=tDist.toFixed(2);
    document.getElementById('ll-dist').textContent='km';
  }
  // FIX: Play button â€” green "ready" when paused, blue "playing" when active
  var btn=document.getElementById('btn-play');
  if(curIv>=ivs.length){
    btn.textContent='âœ“';btn.className='bp ready';
  }else if(isRun){
    btn.textContent='â¸';btn.className='bp playing';
  }else{
    btn.textContent='â–¶';btn.className='bp ready';
  }
}

function handlePlay(){
  initA();
  if(!curWO)autoLoad();
  if(curIv>=ivs.length)return;
  isRun=!isRun;
  if(isRun){
    lastTickTime=Date.now();
    snd(ivs[curIv][0]);vPhase(ivs[curIv][0]);
    startGPS();requestWakeLock();
    if(tH)clearInterval(tH);tH=setInterval(tick,1000);
  }else{
    if(tH){clearInterval(tH);tH=null;}
    lastTickTime=0;
    stopGPS();releaseWakeLock();
  }
  refreshTimer();
}

function tick(){
  lastTickTime=Date.now();
  secLeft--;totEl++;
  var tD=0;for(var i=0;i<ivs.length;i++)tD+=ivs[i][1];
  if(!halfSp&&totEl>=tD/2){halfSp=true;if(voiceMode==='full'){var m=COACH.halfway;speak(m[Math.floor(Math.random()*m.length)]);}}
  if(secLeft===10&&curIv<ivs.length-1){snd('tick');var nt=ivs[curIv+1][0];speak('10 seconds. Get ready to '+nt+'.');}
  if(secLeft>0&&secLeft<=3)snd('tick');
  if(secLeft<=0){
    curIv++;
    if(curIv<ivs.length){
      secLeft=ivs[curIv][1];snd(ivs[curIv][0]);vPhase(ivs[curIv][0]);
      // Haptic feedback on interval change
      try{if(navigator.vibrate)navigator.vibrate([100,50,100]);}catch(e){}
      var tip=COACH.tips[ivs[curIv][0]]||'';document.getElementById('t-coach').textContent=tip;
      if(voiceMode==='full'&&tip)setTimeout(function(){speak(tip);},3500);
    }else{
      if(tH){clearInterval(tH);tH=null;}isRun=false;halfSp=false;lastTickTime=0;
      stopGPS();releaseWakeLock();
      snd('done');vPhase('done');
      // Haptic for completion
      try{if(navigator.vibrate)navigator.vibrate([100,50,100,50,200]);}catch(e){}
      document.getElementById('t-coach').textContent="You're a champion! ğŸ†";
      showSummary();
    }
  }
  refreshTimer();
}

function skipInterval(){if(!isRun||curIv>=ivs.length)return;totEl+=secLeft;secLeft=0;tick();}
function resetTimer(){
  if(tH){clearInterval(tH);tH=null;}
  isRun=false;halfSp=false;lastTickTime=0;
  stopGPS();releaseWakeLock();
  if(curWO){curIv=0;totEl=0;secLeft=ivs[0][1];sCals=0;tDist=0;cPace='--';}
  document.getElementById('t-coach').textContent='Tap play to start';
  refreshTimer();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// POST-RUN SUMMARY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showSummary(){
  if(!curWO)return;
  // Save progress
  var p=sg('prog',{});
  p[curWO.week+'-'+curWO.day]={cal:sCals,dist:parseFloat(tDist.toFixed(2)),pace:cPace,date:new Date().toISOString()};
  ss('prog',p);
  var h=sg('history',[]);
  h.unshift({w:curWO.week,d:curWO.day,cal:sCals,dist:parseFloat(tDist.toFixed(2)),pace:cPace,date:new Date().toLocaleDateString()});
  ss('history',h);

  // XP
  var runMin=0;for(var i=0;i<ivs.length;i++)if(ivs[i][0]==='run')runMin+=ivs[i][1]/60;
  var earned=Math.round(50+runMin*10+(curWO.week*5));
  var oldXP=gXP();ss('xp',oldXP+earned);

  // Check new badges
  var stats=getStats();var oldBadges=gBadges();var newBadges=[];
  for(var i=0;i<BADGES.length;i++){
    var b=BADGES[i];
    if(oldBadges.indexOf(b.id)===-1&&b.check(stats)){newBadges.push(b);oldBadges.push(b.id);}
  }
  ss('badges',oldBadges);

  // Populate summary
  var st=gSet();
  document.getElementById('sum-wk').textContent='Week '+(curWO.week+1)+' Â· Day '+(curWO.day+1);
  var qi=Math.floor(Math.random()*QUOTES.length);
  document.getElementById('sum-quote').textContent='"'+QUOTES[qi].q+'"';

  var distV=st.units==='mi'?(tDist*0.621371).toFixed(2)+' mi':tDist.toFixed(2)+' km';
  var paceV=cPace==='--'?'--':st.units==='mi'?(parseFloat(cPace)*1.609).toFixed(1):cPace;
  var tD=0;for(var i=0;i<ivs.length;i++)tD+=ivs[i][1];

  document.getElementById('sum-grid').innerHTML=
    '<div class="sum-card"><div class="sv" style="color:var(--tm)">'+fmt(tD)+'</div><div class="sl">Duration</div></div>'+
    '<div class="sum-card"><div class="sv" style="color:var(--warm)">'+sCals+'</div><div class="sl">Calories</div></div>'+
    '<div class="sum-card"><div class="sv" style="color:var(--done)">'+distV+'</div><div class="sl">Distance</div></div>'+
    '<div class="sum-card"><div class="sv" style="color:var(--walk)">'+paceV+'</div><div class="sl">Pace '+(st.units==='mi'?'min/mi':'min/km')+'</div></div>';

  document.getElementById('sum-xp').textContent='+'+earned+' XP';

  var badgeHTML='';
  for(var i=0;i<newBadges.length;i++){
    var nb=newBadges[i];
    badgeHTML+='<div class="sum-badge pop" style="animation-delay:'+(i*.15)+'s"><div class="badge-icon">'+nb.icon+'</div><div class="badge-info"><div class="badge-name">'+nb.name+'</div><div class="badge-desc">'+nb.desc+'</div></div></div>';
  }
  document.getElementById('sum-badges').innerHTML=badgeHTML;
  document.getElementById('sum-overlay').classList.add('open');
  setTimeout(fireConfetti,200);
}

function closeSummary(){
  document.getElementById('sum-overlay').classList.remove('open');
  curWO=null;go('plan');renderPlan();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PROGRESS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderProgress(){
  var p=sg('prog',{});var st=gSet();var stats=getStats();
  var totalXP=gXP();var earned=gBadges();

  // Find level
  var lvl=LEVELS[0];var nextLvl=LEVELS[1]||null;
  for(var i=LEVELS.length-1;i>=0;i--){if(totalXP>=LEVELS[i].xp){lvl=LEVELS[i];nextLvl=LEVELS[i+1]||null;break;}}

  var el=document.getElementById('progress-scr');
  var html='';

  // Level bar
  var lvlPct=nextLvl?((totalXP-lvl.xp)/(nextLvl.xp-lvl.xp)*100):100;
  html+='<div class="lvl-bar"><div class="lvl-icon">'+lvl.icon+'</div><div class="lvl-info"><div class="lvl-name">'+lvl.name+'</div><div class="lvl-sub">'+(nextLvl?'Next: '+nextLvl.name+' ('+nextLvl.xp+' XP)':'Max level!')+'</div><div class="lvl-track"><div class="lvl-fill" style="width:'+Math.min(100,lvlPct)+'%"></div></div></div><div class="lvl-xp">'+totalXP+'</div></div>';

  // Stats
  var distV=st.units==='mi'?(stats.dist*0.621371).toFixed(1):stats.dist.toFixed(1);
  html+='<div class="srow"><div class="sc"><div class="sv">'+stats.total+'</div><div class="sl">Workouts</div></div><div class="sc"><div class="sv">'+Math.round((stats.total/27)*100)+'%</div><div class="sl">Complete</div></div><div class="sc"><div class="sv" style="color:var(--warm)">'+stats.cals+'</div><div class="sl">Total kcal</div></div><div class="sc"><div class="sv" style="color:var(--walk)">'+distV+'</div><div class="sl">Total '+(st.units==='mi'?'mi':'km')+'</div></div></div>';

  // Grid (7 cols â€” fits 375px nicely, 27 cells fills 4 rows)
  html+='<div class="pgrid">';
  for(var w=0;w<9;w++)for(var d=0;d<3;d++){var dn=p[w+'-'+d]!=null;html+='<div class="pc'+(dn?' dn':'')+'"><div class="pw">W'+(w+1)+'</div><div class="pd">'+(dn?'âœ“':'D'+(d+1))+'</div></div>';}
  html+='</div>';

  // Badges
  html+='<div class="badges-title">Achievements</div><div class="badges-grid">';
  for(var i=0;i<BADGES.length;i++){var b=BADGES[i];var has=earned.indexOf(b.id)!==-1;html+='<div class="badge-cell'+(has?' earned':'')+'"><div class="be">'+(has?b.icon:'ğŸ”’')+'</div><div class="bn">'+b.name+'</div></div>';}
  html+='</div>';

  // History
  var hist=sg('history',[]);
  if(hist.length>0){
    html+='<div class="htitle">Recent Workouts</div><div class="hlist">';
    var max=Math.min(hist.length,10);
    for(var i=0;i<max;i++){
      var it=hist[i];var dS=st.units==='mi'?((it.dist||0)*0.621371).toFixed(2)+' mi':((it.dist||0).toFixed(2)+' km');
      html+='<div class="hi"><div class="hl">W'+(it.w+1)+'D'+(it.d+1)+' <span style="color:var(--td);font-size:10px;margin-left:5px">'+it.date+'</span></div><div class="hr"><span style="color:var(--warm)">'+(it.cal||0)+' kcal</span><span style="color:var(--done)">'+dS+'</span></div></div>';
    }
    html+='</div>';
  }

  html+='<button class="rbtn" onclick="resetProgress()">Reset All Progress</button>';
  el.innerHTML=html;
}

function resetProgress(){if(confirm('Reset all progress? Cannot be undone.')){try{localStorage.removeItem('c25k_prog');localStorage.removeItem('c25k_history');localStorage.removeItem('c25k_xp');localStorage.removeItem('c25k_badges');}catch(e){}renderProgress();renderPlan();}}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BODY / WEIGHT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function logWeight(){
  var v=parseFloat(document.getElementById('wt-in').value);
  if(!v||v<20||v>300)return;
  var logs=sg('wlogs',[]);
  logs.push({w:v,d:new Date().toISOString().split('T')[0],ts:Date.now()});
  ss('wlogs',logs);
  document.getElementById('wt-in').value='';
  renderBody();
}

function deleteWeight(idx){
  var logs=sg('wlogs',[]);logs.splice(idx,1);ss('wlogs',logs);renderBody();
}

function renderBody(){
  var logs=sg('wlogs',[]);
  document.getElementById('wt-nodata').style.display=logs.length>0?'none':'flex';

  // Summary
  var sum=document.getElementById('wt-summary');
  if(logs.length>0){
    var first=logs[0].w,last=logs[logs.length-1].w,diff=last-first;
    var col=diff<=0?'var(--done)':'var(--run)';
    sum.innerHTML='<div class="ws"><div class="wsv" style="color:var(--tm)">'+first.toFixed(1)+'</div><div class="wsl">Start kg</div></div><div class="ws"><div class="wsv">'+last.toFixed(1)+'</div><div class="wsl">Current kg</div></div><div class="ws"><div class="wsv" style="color:'+col+'">'+(diff>0?'+':'')+diff.toFixed(1)+'</div><div class="wsl">Change kg</div></div>';
  }else{sum.innerHTML='';}

  // Chart
  drawChart(logs);

  // Log entries
  var logEl=document.getElementById('wt-log');
  var titleEl=document.getElementById('wt-log-title');
  if(logs.length>0){
    titleEl.style.display='block';
    var html='';
    var show=logs.slice().reverse().slice(0,15);
    for(var i=0;i<show.length;i++){
      var realIdx=logs.length-1-i;
      html+='<div class="wt-entry"><span class="we-date">'+show[i].d+'</span><span class="we-val">'+show[i].w.toFixed(1)+' kg</span><button class="we-del" onclick="deleteWeight('+realIdx+')">âœ•</button></div>';
    }
    logEl.innerHTML=html;
  }else{titleEl.style.display='none';logEl.innerHTML='';}
}

function drawChart(logs){
  var canvas=document.getElementById('wt-canvas');
  var ctx=canvas.getContext('2d');
  var dpr=window.devicePixelRatio||1;
  var rect=canvas.parentElement.getBoundingClientRect();
  canvas.width=rect.width*dpr;canvas.height=150*dpr;
  canvas.style.width=rect.width+'px';canvas.style.height='150px';
  ctx.scale(dpr,dpr);
  var W=rect.width,H=150;
  ctx.clearRect(0,0,W,H);
  if(logs.length<2)return;

  var vals=logs.map(function(l){return l.w;});
  var mn=Math.min.apply(null,vals)-1;var mx=Math.max.apply(null,vals)+1;
  if(mx===mn)mx=mn+2;
  var pad={t:10,b:25,l:35,r:10};
  var cW=W-pad.l-pad.r,cH=H-pad.t-pad.b;

  // Grid lines
  ctx.strokeStyle='#2a2a3d';ctx.lineWidth=.5;
  var steps=4;
  for(var i=0;i<=steps;i++){
    var y=pad.t+cH*(i/steps);
    ctx.beginPath();ctx.moveTo(pad.l,y);ctx.lineTo(W-pad.r,y);ctx.stroke();
    ctx.fillStyle='#7c7c9a';ctx.font='10px JetBrains Mono';ctx.textAlign='right';
    ctx.fillText((mx-(mx-mn)*(i/steps)).toFixed(1),pad.l-5,y+3);
  }

  // Line
  ctx.beginPath();ctx.strokeStyle='#00ccff';ctx.lineWidth=2;ctx.lineJoin='round';
  for(var i=0;i<vals.length;i++){
    var x=pad.l+(i/(vals.length-1))*cW;
    var y=pad.t+cH*(1-(vals[i]-mn)/(mx-mn));
    if(i===0)ctx.moveTo(x,y);else ctx.lineTo(x,y);
  }
  ctx.stroke();

  // Gradient fill
  var grad=ctx.createLinearGradient(0,pad.t,0,H-pad.b);
  grad.addColorStop(0,'rgba(0,204,255,0.2)');grad.addColorStop(1,'rgba(0,204,255,0)');
  ctx.lineTo(pad.l+(vals.length-1)/(vals.length-1)*cW,H-pad.b);
  ctx.lineTo(pad.l,H-pad.b);ctx.closePath();ctx.fillStyle=grad;ctx.fill();

  // Dots
  for(var i=0;i<vals.length;i++){
    var x=pad.l+(i/(vals.length-1))*cW;
    var y=pad.t+cH*(1-(vals[i]-mn)/(mx-mn));
    ctx.beginPath();ctx.arc(x,y,3,0,Math.PI*2);ctx.fillStyle='#00ccff';ctx.fill();
  }
}

// FIX: Redraw chart on resize/orientation change
var resizeTimer=null;
window.addEventListener('resize',function(){
  clearTimeout(resizeTimer);
  resizeTimer=setTimeout(function(){
    if(document.getElementById('body-scr').classList.contains('on')){
      renderBody();
    }
  },200);
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SETTINGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openSettings(){var s=gSet();document.getElementById('s-wt').value=s.weight||70;document.getElementById('s-un').value=s.units||'km';document.getElementById('s-vc').value=s.voice||'full';document.getElementById('set-mo').classList.add('open');}
function closeSettings(){document.getElementById('set-mo').classList.remove('open');}
function saveSettings(){
  var s={weight:parseInt(document.getElementById('s-wt').value)||70,units:document.getElementById('s-un').value,voice:document.getElementById('s-vc').value};
  ss('settings',s);voiceMode=s.voice;voiceOn=s.voice!=='off';
  document.getElementById('voice-btn').classList.toggle('on',voiceOn);
  closeSettings();
  // FIX: Immediately update timer display with new units
  refreshTimer();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function(){
  var s=gSet();voiceMode=s.voice||'full';voiceOn=voiceMode!=='off';
  document.getElementById('voice-btn').classList.toggle('on',voiceOn);
  renderPlan();
})();
</script>
</body>
</html>
