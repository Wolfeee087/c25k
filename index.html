<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="C25K">
<meta name="theme-color" content="#08080e">
<meta name="description" content="Couch to 5K+ â€” a progressive 14-week running program with voice coaching, GPS tracking, and progress stats">
<link rel="manifest" href="manifest.json">
<title>C25K+ â€” Couch to 5K and Beyond</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#08080e;--s1:#111119;--s2:#1a1a26;--s3:#222233;--brd:#2a2a3d;
  --t:#eeeef4;--td:#7c7c9a;--tm:#a0a0bc;
  --run:#ff4d2a;--runs:#ff4d2a20;--rung:#ff4d2a50;
  --walk:#00ccff;--walks:#00ccff20;--walkg:#00ccff50;
  --warm:#ffb020;--warms:#ffb02020;--warmg:#ffb02050;
  --cool:#9955ff;--cools:#9955ff20;--coolg:#9955ff50;
  --done:#00e676;--dones:#00e67620;--doneg:#00e67650;
  --gold:#ffd740;
  --r:14px;--rs:10px;
  --sat:env(safe-area-inset-top);
  --sab:env(safe-area-inset-bottom)
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html{touch-action:manipulation}
body{font-family:'Outfit',-apple-system,BlinkMacSystemFont,'SF Pro Display','Segoe UI',sans-serif;background:var(--bg);color:var(--t);min-height:100dvh;overflow-x:hidden;-webkit-font-smoothing:antialiased}
.app{max-width:460px;margin:0 auto;padding:0 16px;min-height:100dvh;display:flex;flex-direction:column;padding-bottom:calc(62px + var(--sab))}

/* Header */
.hdr{padding:calc(12px + var(--sat)) 0 6px;display:flex;align-items:center;justify-content:space-between}
.hdr-l .logo{font-size:10px;font-weight:700;letter-spacing:3.5px;text-transform:uppercase;color:var(--td)}
.hdr-l h1{font-size:26px;font-weight:900;letter-spacing:-1px;background:linear-gradient(135deg,var(--run),var(--walk));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.hdr-r{display:flex;gap:7px}
.ib{width:36px;height:36px;border-radius:10px;border:1.5px solid var(--brd);background:var(--s1);color:var(--td);font-size:14px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s}
.ib.on{border-color:var(--run);color:var(--run);background:var(--runs)}
.ib:active{transform:scale(.9)}

/* Streak banner */
.streak-bar{display:flex;align-items:center;gap:7px;padding:7px 12px;background:var(--s1);border:1px solid var(--brd);border-radius:var(--rs);margin-bottom:10px;font-size:12px}
.streak-bar .flame{font-size:16px}
.streak-bar .streak-num{font-family:'JetBrains Mono',monospace;font-weight:700;color:var(--warm)}
.streak-bar .streak-txt{color:var(--td)}
.streak-bar .xp-badge{margin-left:auto;font-family:'JetBrains Mono',monospace;font-size:11px;font-weight:700;color:var(--walk);background:var(--walks);padding:3px 9px;border-radius:20px}

/* Bottom Nav */
.bnav{position:fixed;bottom:0;left:0;right:0;background:var(--s1);border-top:1px solid var(--brd);display:flex;justify-content:center;z-index:50;padding-bottom:var(--sab)}
.bnav-inner{display:flex;max-width:460px;width:100%}
.bnav button{flex:1;padding:8px 0 6px;border:none;background:transparent;color:var(--td);font-family:inherit;font-size:10px;font-weight:600;cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:2px;transition:all .2s}
.bnav button .ni{font-size:18px;line-height:1}
.bnav button.on{color:var(--run)}
.bnav button.on .ni{transform:scale(1.1)}

/* Screens */
.scr{display:none;flex:1;flex-direction:column;overflow-y:auto;-webkit-overflow-scrolling:touch}.scr.on{display:flex}

/* Plan */
.wscrl{display:flex;gap:5px;overflow-x:auto;padding:2px 0 10px;scrollbar-width:none;scroll-behavior:smooth}.wscrl::-webkit-scrollbar{display:none}
.wk{flex-shrink:0;width:40px;height:40px;border-radius:10px;border:2px solid var(--brd);background:var(--s1);color:var(--td);font-family:inherit;font-size:13px;font-weight:700;cursor:pointer;transition:all .2s;position:relative}
.wk.on{border-color:var(--run);color:var(--t);background:var(--runs);box-shadow:0 0 12px var(--rung)}
.wk.dn{border-color:var(--done);color:var(--done)}
.wk.dn::after{content:'âœ“';position:absolute;top:-5px;right:-4px;font-size:9px;background:var(--done);color:var(--bg);width:14px;height:14px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:800}
.wk.beyond{border-color:var(--cool);color:var(--cool)}
.wk.beyond.on{border-color:var(--cool);background:var(--cools);box-shadow:0 0 12px var(--coolg)}
.dcds{display:flex;flex-direction:column;gap:9px;padding-bottom:16px}
.dc{background:var(--s1);border:1px solid var(--brd);border-radius:var(--r);padding:14px;cursor:pointer;transition:all .15s;position:relative;overflow:hidden}
.dc:active{transform:scale(.985);background:var(--s2)}
.dc.cd{border-color:var(--done);opacity:.6}
.dc.cd::before{content:'COMPLETED';position:absolute;top:10px;right:12px;font-size:9px;font-weight:800;color:var(--done);letter-spacing:1.5px}
.dc .dt{font-size:16px;font-weight:700;margin-bottom:2px}
.dc .ds{font-size:11px;color:var(--td);margin-bottom:7px;line-height:1.5}
.dc .dd{display:flex;gap:12px;font-family:'JetBrains Mono',monospace;font-size:11px;font-weight:500}
.dc .dd span{display:flex;align-items:center;gap:4px}
.dc .dd .rv{color:var(--run)}.dc .dd .wv{color:var(--walk)}.dc .dd .tv{color:var(--tm)}
.ivp{display:flex;gap:2px;margin-top:8px;height:4px;border-radius:3px;overflow:hidden}
.ivb{border-radius:3px}.ivb.warmup{background:var(--warm)}.ivb.run{background:var(--run)}.ivb.walk{background:var(--walk)}.ivb.cooldown{background:var(--cool)}
.repeat-btn{margin-top:6px;padding:10px;border:1.5px dashed var(--brd);border-radius:var(--rs);background:transparent;color:var(--td);font-family:inherit;font-size:12px;font-weight:600;cursor:pointer;width:100%;text-align:center;transition:all .2s}
.repeat-btn:active{border-color:var(--walk);color:var(--walk)}
.pv-btn{position:absolute;top:10px;right:12px;background:var(--s2);border:1px solid var(--brd);border-radius:6px;color:var(--td);font-family:inherit;font-size:9px;font-weight:600;padding:3px 8px;cursor:pointer;z-index:2;transition:all .2s}
.pv-btn:active{border-color:var(--walk);color:var(--walk)}
.dc.cd .pv-btn{display:none}

/* Daily tip */
.tip-box{background:var(--s1);border:1px solid var(--brd);border-radius:var(--rs);padding:9px 12px;margin-bottom:10px;font-size:11px;color:var(--tm);display:flex;flex-wrap:wrap;align-items:flex-start;gap:8px;line-height:1.5}
.tip-box .tip-icon{font-size:16px;flex-shrink:0}
.sched-bar{display:flex;gap:4px;margin-top:6px;width:100%}
.sched-day{font-size:9px;font-weight:600;color:var(--td);padding:2px 5px;border-radius:4px;text-align:center;flex:1}
.sched-day.run{color:var(--run);background:var(--runs)}
.sched-day.today{font-weight:800;color:var(--t);border:1px solid var(--brd)}

/* Section label for beyond */
.section-lbl{font-size:9px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--cool);margin:4px 0 2px;padding-left:2px}

/* Timer */
.tscr{align-items:center;justify-content:space-between;padding:4px 0 10px;gap:0}
.t-top{text-align:center;width:100%}
.twk{font-size:11px;font-weight:600;color:var(--td);letter-spacing:2.5px;text-transform:uppercase;margin-bottom:4px}
.tph{font-size:40px;font-weight:900;letter-spacing:-1.5px;text-transform:uppercase;transition:color .3s;line-height:1.1}
.tph.run{color:var(--run)}.tph.walk{color:var(--walk)}.tph.warmup{color:var(--warm)}.tph.cooldown{color:var(--cool)}.tph.done{color:var(--done)}.tph.ready{color:var(--tm)}
.tco{font-size:12px;color:var(--td);margin-top:2px;min-height:18px;font-style:italic}

/* Treadmill + music hint bar */
.timer-hints{display:flex;gap:6px;width:100%;max-width:320px;margin-top:4px;margin-bottom:2px}
.hint-pill{flex:1;display:flex;align-items:center;justify-content:center;gap:5px;padding:5px 8px;background:var(--s1);border:1px solid var(--brd);border-radius:20px;font-size:10px;color:var(--td);cursor:pointer;transition:all .2s}
.hint-pill.on{border-color:var(--walk);color:var(--walk);background:var(--walks)}
.hint-pill:active{transform:scale(.95)}

.t-mid{display:flex;flex-direction:column;align-items:center;gap:10px}
.rw{position:relative;width:180px;height:180px}
.rw svg{width:100%;height:100%;transform:rotate(-90deg)}
.rbg{fill:none;stroke:var(--s2);stroke-width:7}
.rfg{fill:none;stroke-width:7;stroke-linecap:round;transition:stroke .3s;will-change:stroke-dashoffset}
.rc{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center}
.rc .rtm{font-family:'JetBrains Mono',monospace;font-size:42px;font-weight:700;letter-spacing:-2px}
.rc .rnx{font-size:11px;color:var(--td);margin-top:1px}

.lss{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;width:100%;max-width:320px}
.ls{background:var(--s1);border:1px solid var(--brd);border-radius:var(--rs);padding:7px 4px;text-align:center}
.ls .lv{font-family:'JetBrains Mono',monospace;font-size:15px;font-weight:700}
.ls .ll{font-size:8px;color:var(--td);text-transform:uppercase;letter-spacing:.5px;margin-top:1px}
.ls .lv.cal{color:var(--warm)}.ls .lv.pace{color:var(--walk)}.ls .lv.dist{color:var(--done)}

.tpb{width:100%;max-width:320px}
.tpb-t{display:flex;justify-content:space-between;font-size:10px;color:var(--td);margin-bottom:3px;font-family:'JetBrains Mono',monospace}
.tpb-b{height:3px;background:var(--s2);border-radius:2px;overflow:hidden}
.tpb-f{height:100%;border-radius:2px;background:linear-gradient(90deg,var(--run),var(--walk));transition:width .3s;will-change:width}

.t-bot{display:flex;flex-direction:column;align-items:center;gap:10px;width:100%}
.tctl{display:flex;gap:14px;align-items:center}
.bp{width:60px;height:60px;border-radius:50%;border:none;color:#fff;font-size:22px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s}
.bp.ready{background:var(--done);box-shadow:0 4px 18px var(--doneg)}
.bp.playing{background:var(--walk);box-shadow:0 4px 18px var(--walkg)}
.bp:active{transform:scale(.9)}
.bs{width:40px;height:40px;border-radius:50%;border:1.5px solid var(--brd);background:var(--s1);color:var(--td);font-size:15px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s}
.bs:active{transform:scale(.9)}

/* Interval preview (under timer) */
.iv-preview{width:100%;max-width:320px;margin-top:4px}
.iv-preview-toggle{font-size:10px;color:var(--td);cursor:pointer;text-align:center;padding:4px;border:none;background:none;font-family:inherit;width:100%}
.iv-preview-list{max-height:120px;overflow-y:auto;display:flex;flex-direction:column;gap:2px;padding:4px 0;scrollbar-width:thin}
.iv-item{display:flex;align-items:center;gap:6px;padding:4px 8px;border-radius:6px;font-size:10px;font-family:'JetBrains Mono',monospace;background:var(--s1);border:1px solid transparent;transition:all .2s}
.iv-item.active{border-color:var(--run);background:var(--runs)}
.iv-item .iv-dot{width:6px;height:6px;border-radius:50%;flex-shrink:0}
.iv-item .iv-dot.warmup{background:var(--warm)}.iv-item .iv-dot.run{background:var(--run)}.iv-item .iv-dot.walk{background:var(--walk)}.iv-item .iv-dot.cooldown{background:var(--cool)}
.iv-item .iv-type{color:var(--tm);text-transform:capitalize;width:60px}.iv-item .iv-dur{color:var(--td)}

/* Post-run summary overlay */
.summary-overlay{display:none;position:fixed;inset:0;background:var(--bg);z-index:200;flex-direction:column;align-items:center;padding:20px;padding-top:calc(20px + var(--sat));padding-bottom:calc(20px + var(--sab));overflow-y:auto}
.summary-overlay.open{display:flex}
.sum-title{font-size:13px;font-weight:700;color:var(--td);letter-spacing:3px;text-transform:uppercase;margin-bottom:4px}
.sum-big{font-size:42px;font-weight:900;margin-bottom:4px;background:linear-gradient(135deg,var(--done),var(--walk));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.sum-sub{font-size:13px;color:var(--td);margin-bottom:16px;text-align:center;padding:0 10px}
.sum-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;width:100%;max-width:320px;margin-bottom:12px}
.sum-card{background:var(--s1);border:1px solid var(--brd);border-radius:var(--r);padding:12px;text-align:center}
.sum-card .sv{font-family:'JetBrains Mono',monospace;font-size:20px;font-weight:700}
.sum-card .sl{font-size:9px;color:var(--td);margin-top:2px;text-transform:uppercase;letter-spacing:1px}
.sum-xp{font-family:'JetBrains Mono',monospace;font-size:16px;font-weight:700;color:var(--walk);background:var(--walks);padding:7px 20px;border-radius:30px;margin-bottom:10px}
.sum-badge{background:var(--s1);border:1px solid var(--gold);border-radius:var(--r);padding:12px 16px;display:flex;align-items:center;gap:10px;margin-bottom:10px;width:100%;max-width:320px}
.sum-badge .badge-icon{font-size:26px}
.sum-badge .badge-info .badge-name{font-size:13px;font-weight:700;color:var(--gold)}
.sum-badge .badge-info .badge-desc{font-size:10px;color:var(--td);margin-top:2px}
.sum-btn{width:100%;max-width:320px;padding:14px;border:none;border-radius:var(--r);background:linear-gradient(135deg,var(--done),#18b85c);color:var(--bg);font-family:inherit;font-size:14px;font-weight:800;letter-spacing:1px;text-transform:uppercase;cursor:pointer;margin-top:6px;transition:all .2s}
.sum-btn:active{transform:scale(.97)}

/* Graduation cert */
.grad-cert{display:none;width:100%;max-width:320px;margin-bottom:12px;background:linear-gradient(135deg,#1a1a2e,#16213e);border:2px solid var(--gold);border-radius:var(--r);padding:20px;text-align:center;position:relative;overflow:hidden}
.grad-cert.show{display:block}
.grad-cert::before{content:'';position:absolute;inset:6px;border:1px solid var(--gold);border-radius:10px;opacity:.3}
.grad-cert .gc-star{font-size:32px;margin-bottom:6px}
.grad-cert .gc-title{font-size:9px;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:var(--gold);margin-bottom:4px}
.grad-cert .gc-main{font-size:20px;font-weight:900;color:var(--t);margin-bottom:2px}
.grad-cert .gc-sub{font-size:11px;color:var(--td);margin-bottom:8px}
.grad-cert .gc-stats{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--tm);line-height:1.8}
.grad-cert .gc-date{font-size:10px;color:var(--td);margin-top:8px;font-style:italic}

/* Progress */
.pscr{padding-bottom:16px}
.srow{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-bottom:12px}
.sc{background:var(--s1);border:1px solid var(--brd);border-radius:var(--r);padding:12px;text-align:center}
.sc .sv{font-family:'JetBrains Mono',monospace;font-size:22px;font-weight:700;color:var(--run)}
.sc .sl{font-size:9px;color:var(--td);margin-top:2px;text-transform:uppercase;letter-spacing:1px}

/* Level bar */
.lvl-bar{background:var(--s1);border:1px solid var(--brd);border-radius:var(--r);padding:12px;margin-bottom:12px;display:flex;align-items:center;gap:10px}
.lvl-icon{font-size:28px}
.lvl-info{flex:1;min-width:0}
.lvl-info .lvl-name{font-size:14px;font-weight:700}
.lvl-info .lvl-sub{font-size:10px;color:var(--td);margin-top:1px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.lvl-info .lvl-track{height:5px;background:var(--s2);border-radius:3px;margin-top:5px;overflow:hidden}
.lvl-info .lvl-fill{height:100%;border-radius:3px;background:linear-gradient(90deg,var(--walk),var(--run));transition:width .5s}
.lvl-xp{font-family:'JetBrains Mono',monospace;font-size:13px;font-weight:700;color:var(--walk);flex-shrink:0}

/* Weekly trend chart */
.trend-chart{background:var(--s1);border:1px solid var(--brd);border-radius:var(--r);padding:14px;margin-bottom:12px;min-height:130px;position:relative}
.trend-chart canvas{width:100%;height:100px}
.trend-chart .tc-title{font-size:10px;font-weight:700;color:var(--td);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px}

/* Progress grid */
.pgrid{display:grid;grid-template-columns:repeat(7,1fr);gap:3px;margin-bottom:14px}
.pc{aspect-ratio:.8;border-radius:5px;border:1.5px solid var(--brd);background:var(--s1);display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:8px;color:var(--td);gap:1px}
.pc .pw{font-weight:700;font-size:7px;letter-spacing:.3px}.pc .pd{font-size:10px;font-weight:800}
.pc.dn{border-color:var(--done);background:var(--dones);color:var(--done)}

/* Badges section */
.badges-title{font-size:12px;font-weight:700;color:var(--tm);letter-spacing:1px;text-transform:uppercase;margin-bottom:7px}
.badges-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:7px;margin-bottom:14px}
.badge-cell{aspect-ratio:1;border-radius:var(--rs);border:1.5px solid var(--brd);background:var(--s1);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:2px;font-size:8px;color:var(--td);transition:all .3s}
.badge-cell.earned{border-color:var(--gold);background:#ffd74012;color:var(--gold)}
.badge-cell .be{font-size:20px}.badge-cell .bn{text-align:center;line-height:1.2}

.htitle{font-size:12px;font-weight:700;color:var(--tm);margin-bottom:7px;letter-spacing:1px;text-transform:uppercase}
.hlist{display:flex;flex-direction:column;gap:4px;margin-bottom:14px}
.hi{display:flex;justify-content:space-between;align-items:center;background:var(--s1);border:1px solid var(--brd);border-radius:var(--rs);padding:10px 12px;font-size:11px}
.hi .hl{color:var(--t);min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex:1;margin-right:8px}
.hi .hr{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--td);display:flex;gap:7px;flex-shrink:0}
.hi .hr span{display:flex;align-items:center;gap:3px}

.rbtn{width:100%;padding:11px;border:1.5px solid var(--brd);border-radius:var(--r);background:transparent;color:var(--td);font-family:inherit;font-size:12px;font-weight:600;cursor:pointer;margin-top:6px;transition:all .2s}
.rbtn:active{border-color:var(--run);color:var(--run)}

/* Body/Weight tracker + BMI */
.bscr{padding-bottom:16px}
.wt-input{display:flex;gap:7px;margin-bottom:14px}
.wt-input input{flex:1;padding:11px;background:var(--s2);border:1.5px solid var(--brd);border-radius:var(--rs);color:var(--t);font-family:inherit;font-size:15px;font-weight:500;outline:none;-webkit-appearance:none}
.wt-input input:focus{border-color:var(--walk)}
.wt-input button{padding:11px 18px;border:none;border-radius:var(--rs);background:var(--run);color:#fff;font-family:inherit;font-size:13px;font-weight:700;cursor:pointer}
.wt-input button:active{transform:scale(.95)}
.wt-chart{background:var(--s1);border:1px solid var(--brd);border-radius:var(--r);padding:14px;margin-bottom:12px;min-height:170px;position:relative}
.wt-chart canvas{width:100%;height:150px}
.wt-chart .no-data{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;color:var(--td);font-size:12px}
.wt-summary{display:grid;grid-template-columns:repeat(3,1fr);gap:7px;margin-bottom:14px}
.wt-summary .ws{background:var(--s1);border:1px solid var(--brd);border-radius:var(--rs);padding:10px;text-align:center}
.wt-summary .ws .wsv{font-family:'JetBrains Mono',monospace;font-size:18px;font-weight:700}
.wt-summary .ws .wsl{font-size:8px;color:var(--td);text-transform:uppercase;letter-spacing:.5px;margin-top:2px}

/* BMI Card */
.bmi-card{background:var(--s1);border:1px solid var(--brd);border-radius:var(--r);padding:14px;margin-bottom:12px}
.bmi-card .bmi-title{font-size:10px;font-weight:700;color:var(--td);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px}
.bmi-card .bmi-row{display:flex;align-items:center;gap:12px}
.bmi-card .bmi-val{font-family:'JetBrains Mono',monospace;font-size:28px;font-weight:700}
.bmi-card .bmi-label{font-size:11px;font-weight:600;padding:3px 10px;border-radius:20px}
.bmi-card .bmi-bar{height:6px;background:var(--s2);border-radius:3px;margin-top:8px;position:relative;overflow:visible}
.bmi-card .bmi-bar-fill{position:absolute;top:-2px;width:10px;height:10px;border-radius:50%;border:2px solid var(--bg);transition:left .5s}
.bmi-card .bmi-scale{display:flex;justify-content:space-between;font-size:8px;color:var(--td);margin-top:4px}
.bmi-card .bmi-hint{font-size:9px;color:var(--td);margin-top:4px;display:none}

.wt-log{display:flex;flex-direction:column;gap:4px}
.wt-entry{display:flex;justify-content:space-between;align-items:center;background:var(--s1);border:1px solid var(--brd);border-radius:var(--rs);padding:9px 12px;font-size:11px}
.wt-entry .we-date{color:var(--td)}.wt-entry .we-val{font-family:'JetBrains Mono',monospace;font-weight:700}
.wt-entry .we-del{background:none;border:none;color:var(--td);font-size:13px;cursor:pointer;padding:0 4px}

/* Quote */
.quote-box{background:var(--s1);border:1px solid var(--brd);border-radius:var(--r);padding:12px 14px;margin-bottom:12px;font-style:italic;font-size:12px;color:var(--tm);line-height:1.5;text-align:center}
.quote-box .qa{display:block;margin-top:3px;font-style:normal;font-size:10px;color:var(--td)}

/* Settings Modal */
.mo{display:none;position:fixed;inset:0;background:#000a;z-index:100;align-items:flex-end;justify-content:center}
.mo.open{display:flex}
.mod{background:var(--s1);border-radius:20px 20px 0 0;padding:22px 18px calc(30px + var(--sab));width:100%;max-width:460px;max-height:80vh;overflow-y:auto}
.mod h2{font-size:17px;font-weight:800;margin-bottom:14px}
.mod-x{float:right;background:none;border:none;color:var(--td);font-size:20px;cursor:pointer;padding:4px}
.fld{margin-bottom:12px}
.fld label{display:block;font-size:10px;font-weight:600;color:var(--td);text-transform:uppercase;letter-spacing:1px;margin-bottom:4px}
.fld input,.fld select{width:100%;padding:10px;background:var(--s2);border:1.5px solid var(--brd);border-radius:var(--rs);color:var(--t);font-family:inherit;font-size:14px;font-weight:500;outline:none;-webkit-appearance:none}
.fld input:focus,.fld select:focus{border-color:var(--walk)}
.fld .ht{font-size:9px;color:var(--td);margin-top:3px}
.fld-row{display:flex;gap:8px}.fld-row .fld{flex:1}
.sbtn{width:100%;padding:12px;border:none;border-radius:var(--r);background:var(--run);color:#fff;font-family:inherit;font-size:14px;font-weight:700;cursor:pointer;margin-top:6px}
.sbtn:active{transform:scale(.97)}
.sbtn.secondary{background:transparent;border:1.5px solid var(--brd);color:var(--td);margin-top:8px}
.sbtn.secondary:active{border-color:var(--walk);color:var(--walk)}
.settings-section{font-size:10px;font-weight:700;color:var(--td);text-transform:uppercase;letter-spacing:1.5px;margin:14px 0 8px;padding-top:10px;border-top:1px solid var(--brd)}

/* Run day selector */
.day-sel{display:flex;gap:4px;margin-top:4px}
.day-sel button{width:36px;height:30px;border-radius:6px;border:1.5px solid var(--brd);background:var(--s2);color:var(--td);font-family:inherit;font-size:10px;font-weight:700;cursor:pointer;transition:all .2s}
.day-sel button.on{border-color:var(--run);color:var(--run);background:var(--runs)}

/* Confetti canvas */
#confetti{position:fixed;inset:0;pointer-events:none;z-index:300}

/* Interval preview modal */
.iv-modal{display:none;position:fixed;inset:0;background:#000a;z-index:100;align-items:center;justify-content:center;padding:20px}
.iv-modal.open{display:flex}
.iv-modal-content{background:var(--s1);border:1px solid var(--brd);border-radius:var(--r);padding:18px;width:100%;max-width:360px;max-height:70vh;overflow-y:auto}
.iv-modal-content h3{font-size:15px;font-weight:800;margin-bottom:10px}
.iv-modal-content .iv-list{display:flex;flex-direction:column;gap:4px;margin-bottom:12px}
.iv-modal-content .iv-row{display:flex;align-items:center;gap:8px;padding:6px 8px;border-radius:6px;font-size:12px}
.iv-modal-content .iv-row .iv-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.iv-modal-content .iv-row .iv-type{text-transform:capitalize;color:var(--tm);width:70px}
.iv-modal-content .iv-row .iv-dur{font-family:'JetBrains Mono',monospace;color:var(--t)}
.iv-modal-close{width:100%;padding:10px;border:none;border-radius:var(--rs);background:var(--run);color:#fff;font-family:inherit;font-size:13px;font-weight:700;cursor:pointer}

@keyframes fadeUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.fu{animation:fadeUp .35s ease forwards}
@keyframes popIn{from{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}
.pop{animation:popIn .4s cubic-bezier(.17,.67,.35,1.3) forwards}

/* Small screens */
@media(max-height:700px){
  .rw{width:150px;height:150px}
  .rc .rtm{font-size:36px}
  .tph{font-size:34px}
  .lss{gap:4px}
  .ls{padding:5px 3px}
  .ls .lv{font-size:13px}
}
</style>
</head>
<body>
<canvas id="confetti"></canvas>
<div class="app">
  <div class="hdr">
    <div class="hdr-l"><div class="logo">Couch to</div><h1>5K+</h1></div>
    <div class="hdr-r">
      <button class="ib" id="voice-btn" onclick="toggleVoice()" title="Voice" aria-label="Toggle voice coach">ğŸ—£</button>
      <button class="ib" onclick="openSettings()" title="Settings" aria-label="Open settings">âš™</button>
    </div>
  </div>

  <div class="streak-bar" id="streak-bar">
    <span class="flame">ğŸ”¥</span>
    <span class="streak-num" id="streak-num">0</span>
    <span class="streak-txt">week streak</span>
    <span class="xp-badge" id="xp-total">0 XP</span>
  </div>

  <!-- PLAN -->
  <div id="plan-scr" class="scr on">
    <div id="tip-box" class="tip-box"></div>
    <div id="quote-box" class="quote-box"></div>
    <div class="wscrl" id="wsel"></div>
    <div class="dcds" id="dcds"></div>
    <button class="repeat-btn" id="repeat-btn" onclick="repeatWeek()">â†» Repeat this week</button>
  </div>

  <!-- TIMER -->
  <div id="timer-scr" class="scr tscr">
    <div class="t-top">
      <div class="twk" id="t-label">Week 1 Â· Day 1</div>
      <div class="tph ready" id="t-phase">Ready</div>
      <div class="tco" id="t-coach">Tap play to start</div>
      <div class="timer-hints">
        <button class="hint-pill" id="treadmill-btn" onclick="toggleTreadmill()">ğŸƒâ€â™‚ï¸ Treadmill</button>
        <button class="hint-pill" onclick="alert('Start your music app first.\nVoice coach plays over it automatically.')">ğŸµ Music tip</button>
      </div>
    </div>
    <div class="t-mid">
      <div class="rw">
        <svg viewBox="0 0 200 200"><circle class="rbg" cx="100" cy="100" r="88"/><circle class="rfg" id="ring" cx="100" cy="100" r="88" stroke-dasharray="553" stroke-dashoffset="553"/></svg>
        <div class="rc"><div class="rtm" id="t-time">0:00</div><div class="rnx" id="t-next"></div></div>
      </div>
      <div class="lss">
        <div class="ls"><div class="lv cal" id="ls-cal">0</div><div class="ll" id="ll-cal">kcal</div></div>
        <div class="ls"><div class="lv pace" id="ls-pace">--</div><div class="ll" id="ll-pace">min/km</div></div>
        <div class="ls"><div class="lv dist" id="ls-dist">0.00</div><div class="ll" id="ll-dist">km</div></div>
      </div>
      <div class="tpb">
        <div class="tpb-t"><span id="tp-el">0:00</span><span id="tp-tot">0:00</span></div>
        <div class="tpb-b"><div class="tpb-f" id="tp-fill" style="width:0%"></div></div>
      </div>
      <div class="iv-preview" id="iv-preview">
        <button class="iv-preview-toggle" id="iv-toggle" onclick="toggleIvPreview()">â–¼ Show intervals</button>
        <div class="iv-preview-list" id="iv-list" style="display:none"></div>
      </div>
    </div>
    <div class="t-bot">
      <div class="tctl">
        <button class="bs" onclick="resetTimer()" aria-label="Reset timer">â†º</button>
        <button class="bp ready" id="btn-play" onclick="handlePlay()" aria-label="Play/Pause">â–¶</button>
        <button class="bs" onclick="skipInterval()" aria-label="Skip interval">â­</button>
      </div>
    </div>
  </div>

  <!-- PROGRESS -->
  <div id="progress-scr" class="scr pscr"></div>

  <!-- BODY -->
  <div id="body-scr" class="scr bscr">
    <div style="font-size:16px;font-weight:800;margin-bottom:12px">Weight & Body Tracker</div>
    <div class="wt-input">
      <input type="number" id="wt-in" step="0.1" min="20" max="700">
      <button onclick="logWeight()">Log</button>
    </div>
    <div id="bmi-section"></div>
    <div class="wt-chart"><canvas id="wt-canvas"></canvas><div class="no-data" id="wt-nodata">Log your first weigh-in above</div></div>
    <div class="wt-summary" id="wt-summary"></div>
    <div class="htitle" id="wt-log-title" style="display:none">Recent Entries</div>
    <div class="wt-log" id="wt-log"></div>
  </div>

  <!-- Bottom Nav -->
  <nav class="bnav" aria-label="Main navigation"><div class="bnav-inner">
    <button class="on" onclick="go('plan')" aria-label="Training plan"><span class="ni">ğŸ“‹</span>Plan</button>
    <button onclick="go('timer')" aria-label="Run timer"><span class="ni">â–¶ï¸</span>Run</button>
    <button onclick="go('progress')" aria-label="Progress stats"><span class="ni">ğŸ“Š</span>Stats</button>
    <button onclick="go('body')" aria-label="Body weight tracker"><span class="ni">âš–ï¸</span>Body</button>
  </div></nav>
</div>

<!-- Post-run summary -->
<div class="summary-overlay" id="sum-overlay">
  <div class="sum-title" id="sum-wk"></div>
  <div class="sum-big">COMPLETE!</div>
  <div class="sum-sub" id="sum-quote"></div>
  <div class="sum-grid" id="sum-grid"></div>
  <div class="sum-xp" id="sum-xp">+0 XP</div>
  <div id="sum-badges"></div>
  <div id="sum-grad"></div>
  <button class="sum-btn" onclick="closeSummary()">Continue</button>
</div>

<!-- Interval Preview Modal -->
<div class="iv-modal" id="iv-modal" onclick="if(event.target===this)closeIvModal()">
  <div class="iv-modal-content" id="iv-modal-content"></div>
</div>

<!-- Settings -->
<div class="mo" id="set-mo" onclick="if(event.target===this)closeSettings()">
  <div class="mod">
    <button class="mod-x" onclick="closeSettings()">âœ•</button>
    <h2>Settings</h2>
    <div class="fld"><label id="lbl-wt">Weight (kg)</label><input type="number" id="s-wt" placeholder="70" min="20" max="700"><div class="ht">Used for calorie estimation</div></div>
    <div class="fld-row">
      <div class="fld"><label id="lbl-ht">Height (cm)</label><input type="number" id="s-ht" placeholder="170" min="100" max="250"></div>
      <div class="fld"><label>Units</label><select id="s-un"><option value="km">Metric</option><option value="mi">Imperial</option></select></div>
    </div>
    <div class="fld"><label>Voice Coach</label><select id="s-vc"><option value="full">Full coaching</option><option value="simple">Simple announcements</option><option value="off">Off</option></select></div>
    <div class="fld"><label id="lbl-pace">Pace Goal (min/km)</label><input type="number" id="s-pace" placeholder="7.0" min="2" max="15" step="0.1"><div class="ht">Voice coach alerts if you're off pace during runs</div></div>

    <div class="settings-section">Schedule & Reminders</div>
    <div class="fld"><label>Run Days</label>
      <div class="day-sel" id="day-sel">
        <button onclick="toggleDay(this,0)">M</button>
        <button onclick="toggleDay(this,1)">T</button>
        <button onclick="toggleDay(this,2)">W</button>
        <button onclick="toggleDay(this,3)">T</button>
        <button onclick="toggleDay(this,4)">F</button>
        <button onclick="toggleDay(this,5)">S</button>
        <button onclick="toggleDay(this,6)">S</button>
      </div>
      <div class="ht">Tap days to schedule your 3 weekly runs</div>
    </div>
    <div class="fld"><label>Reminder Time</label><input type="time" id="s-remind" value="07:00"><div class="ht" id="remind-status">Enable notifications below</div></div>
    <button class="sbtn secondary" onclick="enableReminders()">ğŸ”” Enable Reminders</button>

    <div class="settings-section">Data</div>
    <button class="sbtn secondary" onclick="exportData()">ğŸ“¤ Export All Data</button>
    <button class="sbtn secondary" onclick="document.getElementById('import-file').click()">ğŸ“¥ Import Data Backup</button>
    <input type="file" id="import-file" accept=".json" style="display:none" onchange="importData(this)">

    <button class="sbtn" onclick="saveSettings()">Save Settings</button>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PROGRAM DATA â€” C25K (wk 1-9) + Beyond 5K (wk 10-14)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function bp(a,b,n){var r=[];for(var i=0;i<n;i++){r.push(['run',a],['walk',b]);}return r;}
function bi(w,ivs,c){var r=[['warmup',w]];for(var i=0;i<ivs.length;i++)r.push(ivs[i]);r.push(['cooldown',c]);return r;}

var P=[
  // Week 1-9: Original C25K
  [bi(300,bp(60,90,8),300),bi(300,bp(60,90,8),300),bi(300,bp(60,90,8),300)],
  [bi(300,bp(90,120,6),300),bi(300,bp(90,120,6),300),bi(300,bp(90,120,6),300)],
  [bi(300,[['run',90],['walk',90],['run',180],['walk',180],['run',90],['walk',90],['run',180],['walk',180]],300),bi(300,[['run',90],['walk',90],['run',180],['walk',180],['run',90],['walk',90],['run',180],['walk',180]],300),bi(300,[['run',90],['walk',90],['run',180],['walk',180],['run',90],['walk',90],['run',180],['walk',180]],300)],
  [bi(300,[['run',180],['walk',90],['run',300],['walk',150],['run',180],['walk',90],['run',300]],300),bi(300,[['run',180],['walk',90],['run',300],['walk',150],['run',180],['walk',90],['run',300]],300),bi(300,[['run',180],['walk',90],['run',300],['walk',150],['run',180],['walk',90],['run',300]],300)],
  [bi(300,[['run',300],['walk',180],['run',300],['walk',180],['run',300]],300),bi(300,[['run',480],['walk',300],['run',480]],300),bi(300,[['run',1200]],300)],
  [bi(300,[['run',300],['walk',180],['run',480],['walk',180],['run',300]],300),bi(300,[['run',600],['walk',180],['run',600]],300),bi(300,[['run',1500]],300)],
  [bi(300,[['run',1500]],300),bi(300,[['run',1500]],300),bi(300,[['run',1500]],300)],
  [bi(300,[['run',1680]],300),bi(300,[['run',1680]],300),bi(300,[['run',1680]],300)],
  [bi(300,[['run',1800]],300),bi(300,[['run',1800]],300),bi(300,[['run',1800]],300)],
  // Week 10-14: Beyond 5K (Bridge to 10K â€” gradual increase)
  [bi(300,[['run',1800],['walk',60],['run',300]],300),bi(300,[['run',1800],['walk',60],['run',600]],300),bi(300,[['run',2100]],300)],
  [bi(300,[['run',2100],['walk',60],['run',300]],300),bi(300,[['run',1200],['walk',60],['run',1200]],300),bi(300,[['run',2400]],300)],
  [bi(300,[['run',2400],['walk',60],['run',300]],300),bi(300,[['run',1500],['walk',60],['run',1500]],300),bi(300,[['run',2700]],300)],
  [bi(300,[['run',1800],['walk',60],['run',1800]],300),bi(300,[['run',2700],['walk',60],['run',300]],300),bi(300,[['run',3000]],300)],
  [bi(300,[['run',3000],['walk',60],['run',300]],300),bi(300,[['run',3300]],300),bi(300,[['run',3600]],300)]
];
var TOTAL_WEEKS=P.length; // 14

var NM=[
  ["Walk + 1min run Ã—8","Walk + 1min run Ã—8","Walk + 1min run Ã—8"],
  ["1.5min run Ã—6","1.5min run Ã—6","1.5min run Ã—6"],
  ["Mixed 1.5 & 3min runs","Mixed 1.5 & 3min runs","Mixed 1.5 & 3min runs"],
  ["3 & 5min run blocks","3 & 5min run blocks","3 & 5min run blocks"],
  ["Three 5min runs","Two 8min runs","20 minute run!"],
  ["5, 8 & 5min runs","Two 10min runs","25 minute run"],
  ["25 minute run","25 minute run","25 minute run"],
  ["28 minute run","28 minute run","28 minute run"],
  ["30 min run ğŸ","30 min run ğŸ","30 min â€” GRADUATE! ğŸ‰"],
  // Beyond 5K
  ["30 + 5min run","30 + 10min run","35 minute run"],
  ["35 + 5min run","Two 20min runs","40 minute run"],
  ["40 + 5min run","Two 25min runs","45 minute run"],
  ["Two 30min runs","45 + 5min run","50 minute run"],
  ["50 + 5min run","55 minute run","60 min â€” 10K READY! ğŸ†"]
];
var COACH={
  run:["Let's go! Start running!","Time to run! You've got this!","Run! Pick up the pace!","Here we go, run!","Push it! Running now!"],
  walk:["Nice work! Walk it out.","Great job, take a breather.","Walking break, you earned it.","Ease up, walk now."],
  warmup:["Let's warm up with a brisk walk.","Warm-up time, get moving!"],
  cooldown:["Almost done! Cool down walk.","Great work! Cool down now."],
  done:["Workout complete! Amazing effort!","You did it! Incredible!"],
  halfway:["Halfway there! Keep pushing!","Half done! You're killing it!","Time to turn around and head back!"],
  almost:["10 seconds! You're almost done!","Nearly there! Last push!"],
  tips:{run:"Keep shoulders relaxed, breathe steady.",walk:"Deep breaths, shake out your arms.",warmup:"Start slow, build your pace.",cooldown:"Gradually slow down. Well done."}
};
var QUOTES=[
  {q:"The miracle isn't that I finished. The miracle is that I had the courage to start.",a:"John Bingham"},
  {q:"A journey of a thousand miles begins with a single step.",a:"Lao Tzu"},
  {q:"You don't have to be great to start, but you have to start to be great.",a:"Zig Ziglar"},
  {q:"The only bad workout is the one that didn't happen.",a:"Unknown"},
  {q:"It does not matter how slowly you go as long as you do not stop.",a:"Confucius"},
  {q:"Your body can stand almost anything. It's your mind you have to convince.",a:"Unknown"},
  {q:"Believe you can and you're halfway there.",a:"Theodore Roosevelt"},
  {q:"Success is the sum of small efforts repeated day in and day out.",a:"Robert Collier"},
  {q:"The hard days are the best because that's when champions are made.",a:"Gabby Douglas"},
  {q:"Run when you can, walk if you have to, crawl if you must; just never give up.",a:"Dean Karnazes"}
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DAILY TIPS â€” rotate one per day
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var TIPS=[
  {icon:"ğŸ’§",t:"Drink 500ml of water 30 minutes before your run. Hydration improves endurance."},
  {icon:"ğŸŒ",t:"Eat a light snack 1-2 hours before running. A banana or toast works great."},
  {icon:"ğŸ˜´",t:"Rest days build muscle. Your body gets stronger while recovering, not while running."},
  {icon:"ğŸ‘Ÿ",t:"Replace running shoes every 500-800km. Worn shoes increase injury risk."},
  {icon:"ğŸ§˜",t:"Stretch after your run, not before. Dynamic warm-ups before, static stretches after."},
  {icon:"ğŸ’ª",t:"Running burns ~100 kcal per km. Combined with diet, it's a powerful weight loss tool."},
  {icon:"ğŸŒ¬ï¸",t:"Breathe in through nose and mouth. Try a 3:2 rhythm â€” 3 steps inhale, 2 steps exhale."},
  {icon:"ğŸƒ",t:"Run at a conversational pace. If you can't talk while running, slow down."},
  {icon:"â°",t:"Morning runs boost metabolism for the whole day. Even 20 minutes makes a difference."},
  {icon:"ğŸ¯",t:"Don't skip the warm-up walk. It reduces injury risk by 50% and improves performance."},
  {icon:"ğŸ“ˆ",t:"Progress isn't linear. Bad runs happen. What matters is showing up consistently."},
  {icon:"ğŸ¥—",t:"Post-run, eat protein within 30 minutes. It helps repair and build muscle."},
  {icon:"â¤ï¸",t:"Running lowers resting heart rate by 1 BPM per week of training. Your heart is getting stronger."},
  {icon:"ğŸ§ ",t:"Running releases endorphins. Studies show 30min of jogging is as effective as antidepressants."},
  {icon:"ğŸ¦¶",t:"Land midfoot, not on your heels. This reduces impact and prevents shin splints."},
  {icon:"ğŸŒ¡ï¸",t:"In hot weather, run early morning or evening. Reduce pace by 30sec/km in heat."},
  {icon:"ğŸ’¤",t:"Aim for 7-9 hours of sleep on run nights. Sleep is when your muscles actually rebuild."},
  {icon:"ğŸ”„",t:"Cross-train on rest days. Walking, swimming, or cycling help without stressing run muscles."},
  {icon:"ğŸ“±",t:"Put your phone in an armband or pocket. Checking it mid-run breaks your rhythm."},
  {icon:"ğŸ…",t:"Sign up for a local 5K race. Having a date on the calendar is the best motivator."},
  {icon:"ğŸª",t:"Take progress photos monthly. The mirror lies, photos don't. You'll be amazed at the change."}
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ACHIEVEMENTS â€” expanded for Beyond 5K
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var BADGES=[
  {id:'first',icon:'ğŸŒŸ',name:'First Step',desc:'Complete your first workout',check:function(s){return s.total>=1}},
  {id:'w1',icon:'1ï¸âƒ£',name:'Week 1',desc:'Complete Week 1',check:function(s){return s.weeks[0]}},
  {id:'w3',icon:'3ï¸âƒ£',name:'Week 3',desc:'Complete Week 3',check:function(s){return s.weeks[2]}},
  {id:'w5',icon:'5ï¸âƒ£',name:'Halfway',desc:'Complete Week 5',check:function(s){return s.weeks[4]}},
  {id:'w9',icon:'ğŸ“',name:'5K Graduate',desc:'Complete Week 9',check:function(s){return s.weeks[8]}},
  {id:'w14',icon:'ğŸ†',name:'10K Ready',desc:'Complete Week 14',check:function(s){return s.weeks[13]}},
  {id:'streak3',icon:'ğŸ”¥',name:'On Fire',desc:'3 week streak',check:function(s){return s.streak>=3}},
  {id:'streak6',icon:'ğŸ’',name:'Unstoppable',desc:'6 week streak',check:function(s){return s.streak>=6}},
  {id:'streak10',icon:'ğŸ‘‘',name:'Legendary',desc:'10 week streak',check:function(s){return s.streak>=10}},
  {id:'cal500',icon:'âš¡',name:'Burner',desc:'Burn 500+ total kcal',check:function(s){return s.cals>=500}},
  {id:'cal2000',icon:'ğŸ”‹',name:'Furnace',desc:'Burn 2000+ total kcal',check:function(s){return s.cals>=2000}},
  {id:'dist5',icon:'ğŸ—ºï¸',name:'Explorer',desc:'Run 5+ total km',check:function(s){return s.dist>=5}},
  {id:'dist25',icon:'ğŸŒ',name:'Voyager',desc:'Run 25+ total km',check:function(s){return s.dist>=25}},
  {id:'dist50',icon:'ğŸš€',name:'Ultra',desc:'Run 50+ total km',check:function(s){return s.dist>=50}},
  {id:'ten',icon:'ğŸ”Ÿ',name:'Double Digits',desc:'Complete 10 workouts',check:function(s){return s.total>=10}},
  {id:'twenty',icon:'ğŸ’ª',name:'Dedicated',desc:'Complete 20 workouts',check:function(s){return s.total>=20}}
];
var LEVELS=[
  {name:'Couch Potato',xp:0,icon:'ğŸ›‹ï¸'},
  {name:'First Timer',xp:100,icon:'ğŸ‘Ÿ'},
  {name:'Getting Started',xp:300,icon:'ğŸš¶'},
  {name:'Jogger',xp:600,icon:'ğŸƒ'},
  {name:'Runner',xp:1000,icon:'ğŸ’¨'},
  {name:'Athlete',xp:1600,icon:'âš¡'},
  {name:'Champion',xp:2400,icon:'ğŸ…'},
  {name:'Legend',xp:3500,icon:'ğŸ†'},
  {name:'Unstoppable',xp:5000,icon:'ğŸ‘‘'},
  {name:'Marathon Spirit',xp:7000,icon:'ğŸ”¥'}
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var selW=0,curWO=null,ivs=[],curIv=0,secLeft=0,totEl=0;
var isRun=false,tH=null,audioCtx=null;
var voiceOn=true,voiceMode='full';
var wakeLock=null;
var lastTickTime=0;
var treadmillMode=false;

// GPS state
var geoW=null,lastP=null,tDist=0,cPace='--';
var gpsResumeSkip=0;
var runDist=0;
var runTimeSec=0;
var recentGPS=[];

var sCals=0,halfSp=false;
var ivPreviewOpen=false;
var paceAlertGiven=false;

// Cached DOM refs
var _el={};
function el(id){if(!_el[id])_el[id]=document.getElementById(id);return _el[id];}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STORAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function sg(k,d){try{var v=localStorage.getItem('c25k_'+k);if(v===null)return d;var parsed=JSON.parse(v);return(parsed!==null&&parsed!==undefined)?parsed:d;}catch(e){try{localStorage.removeItem('c25k_'+k);}catch(e2){}return d}}
function ss(k,v){try{localStorage.setItem('c25k_'+k,JSON.stringify(v))}catch(e){}}
function isDn(w,d){return sg('prog',{})[w+'-'+d]!=null}
function wkDn(w){return isDn(w,0)&&isDn(w,1)&&isDn(w,2)}
function gSet(){return sg('settings',{weight:70,height:170,units:'km',voice:'full',paceGoal:0,runDays:[1,3,5],remindTime:'07:00'})}
function gXP(){return sg('xp',0)}
function gBadges(){return sg('badges',[])}

function getWeightKg(){
  var s=gSet();var w=s.weight||70;
  if(s.units==='mi')return w*0.453592;
  return w;
}
function getHeightM(){
  var s=gSet();var h=s.height||170;
  if(s.units==='mi')return h*0.0254; // stored as inches
  return h/100;
}

function getStats(){
  var p=sg('prog',{});var total=0,cals=0,dist=0,weeks=[];
  for(var w=0;w<TOTAL_WEEKS;w++){
    var wd=true;
    for(var d=0;d<3;d++){
      var k=w+'-'+d;
      if(p[k]!=null){total++;if(p[k].cal)cals+=p[k].cal;if(p[k].dist)dist+=p[k].dist;}
      else wd=false;
    }
    weeks.push(wd);
  }
  return{total:total,cals:cals,dist:dist,weeks:weeks,streak:calcStreak()};
}

function calcStreak(){
  var s=0;
  for(var w=0;w<TOTAL_WEEKS;w++){if(wkDn(w))s++;else break;}
  return s;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TREADMILL MODE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toggleTreadmill(){
  treadmillMode=!treadmillMode;
  document.getElementById('treadmill-btn').classList.toggle('on',treadmillMode);
  if(treadmillMode){stopGPS();}
}
function getTreadmillDist(){
  // Estimate: run=9km/h walk=5km/h warmup=5km/h cooldown=4km/h
  var speeds={warmup:5,run:9,walk:5,cooldown:4};
  var d=0;
  for(var i=0;i<curIv&&i<ivs.length;i++){
    d+=(speeds[ivs[i][0]]||5)*ivs[i][1]/3600;
  }
  if(curIv<ivs.length){
    var elapsed=ivs[curIv][1]-secLeft;
    d+=(speeds[ivs[curIv][0]]||5)*elapsed/3600;
  }
  return d;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// WAKE LOCK
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function requestWakeLock(){
  try{if('wakeLock' in navigator){wakeLock=await navigator.wakeLock.request('screen');wakeLock.addEventListener('release',function(){wakeLock=null;});}}catch(e){}
}
function releaseWakeLock(){
  try{if(wakeLock){wakeLock.release();wakeLock=null;}}catch(e){}
}
document.addEventListener('visibilitychange',function(){
  if(document.visibilityState==='visible'&&isRun){requestWakeLock();recoverLostTime();}
});

function recoverLostTime(){
  if(!isRun||!lastTickTime||curIv>=ivs.length)return;
  var now=Date.now();var elapsed=Math.round((now-lastTickTime)/1000);
  if(elapsed<=1)return;
  elapsed=Math.min(elapsed,3600);
  for(var i=0;i<elapsed&&curIv<ivs.length;i++){
    secLeft--;totEl++;
    if(curIv<ivs.length&&ivs[curIv][0]==='run')runTimeSec++;
    if(secLeft<=0){
      curIv++;
      if(curIv<ivs.length){secLeft=ivs[curIv][1];}
      else{
        if(tH){clearInterval(tH);tH=null;}
        isRun=false;halfSp=false;stopGPS();releaseWakeLock();
        sCals=calcCal();snd('done');vPhase('done');
        document.getElementById('t-coach').textContent="You're a champion! ğŸ†";
        refreshTimer();showSummary();return;
      }
    }
  }
  lastTickTime=now;refreshTimer();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUDIO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initA(){try{if(!audioCtx)audioCtx=new(window.AudioContext||window.webkitAudioContext)();if(audioCtx.state==='suspended')audioCtx.resume();}catch(e){}}
function beep(f,dur,n){try{initA();if(!audioCtx)return;var t=audioCtx.currentTime;for(var i=0;i<n;i++){var o=audioCtx.createOscillator(),g=audioCtx.createGain();o.connect(g);g.connect(audioCtx.destination);o.frequency.value=f;o.type='sine';g.gain.setValueAtTime(.25,t);g.gain.exponentialRampToValueAtTime(.01,t+dur);o.start(t);o.stop(t+dur);t+=dur+.12;}}catch(e){}}
function snd(t){try{if(t==='run')beep(880,.12,3);else if(t==='walk')beep(523,.18,2);else if(t==='warmup')beep(660,.18,1);else if(t==='cooldown')beep(440,.25,2);else if(t==='done')beep(1047,.12,5);else if(t==='tick')beep(660,.06,1);}catch(e){}}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VOICE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function speak(text){try{if(!voiceOn||voiceMode==='off'||!window.speechSynthesis)return;window.speechSynthesis.cancel();var u=new SpeechSynthesisUtterance(text);u.rate=1;u.pitch=1;u.volume=1;window.speechSynthesis.speak(u);}catch(e){}}
function vPhase(type){try{var msgs=COACH[type]||[];if(voiceMode==='simple'){var m={run:'Run!',walk:'Walk!',warmup:'Warm up!',cooldown:'Cool down!',done:'Workout complete!'};speak(m[type]||type);}else if(msgs.length>0){speak(msgs[Math.floor(Math.random()*msgs.length)]);}}catch(e){}}
function toggleVoice(){voiceOn=!voiceOn;document.getElementById('voice-btn').classList.toggle('on',voiceOn);}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GPS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function startGPS(){
  if(treadmillMode)return;
  try{if(!navigator.geolocation||geoW!=null)return;gpsResumeSkip=0;geoW=navigator.geolocation.watchPosition(onGPS,function(){},{enableHighAccuracy:true,maximumAge:3000,timeout:10000});}catch(e){}
}
function resumeGPS(){
  if(treadmillMode)return;
  try{if(!navigator.geolocation||geoW!=null)return;gpsResumeSkip=2;lastP=null;geoW=navigator.geolocation.watchPosition(onGPS,function(){},{enableHighAccuracy:true,maximumAge:3000,timeout:10000});}catch(e){}
}
function onGPS(p){
  if(p.coords.accuracy>25)return;
  if(gpsResumeSkip>0){gpsResumeSkip--;lastP=p;return;}
  if(lastP&&isRun){
    var d=hav(lastP.coords.latitude,lastP.coords.longitude,p.coords.latitude,p.coords.longitude);
    var dt=((p.timestamp||Date.now())-(lastP.timestamp||Date.now()))/1000;
    if(dt>0.5){
      var speedKmh=(d/dt)*3600;
      if(d>0.002&&d<0.2&&speedKmh<40){
        tDist+=d;
        if(curIv<ivs.length&&ivs[curIv][0]==='run')runDist+=d;
        var now=Date.now();recentGPS.push({t:now,d:d});
        while(recentGPS.length>0&&now-recentGPS[0].t>30000)recentGPS.shift();
      }
    }
  }
  lastP=p;
}
function stopGPS(){try{if(geoW!=null){navigator.geolocation.clearWatch(geoW);geoW=null;}}catch(e){}}
function resetGPSState(){stopGPS();tDist=0;runDist=0;lastP=null;cPace='--';runTimeSec=0;recentGPS=[];gpsResumeSkip=0;}
function calcCurrentPace(){
  if(treadmillMode){var s=gSet();return s.paceGoal>0?s.paceGoal.toString():'--';}
  if(recentGPS.length<2)return'--';
  var totalD=0;for(var i=0;i<recentGPS.length;i++)totalD+=recentGPS[i].d;
  if(totalD<0.005)return'--';
  var timeSpan=(recentGPS[recentGPS.length-1].t-recentGPS[0].t)/1000/60;
  if(timeSpan<0.05)return'--';
  var mpk=timeSpan/totalD;if(mpk>30||mpk<2)return'--';return mpk.toFixed(1);
}
function calcAvgRunPace(){
  if(runDist<0.01||runTimeSec<10)return'--';
  var mpk=(runTimeSec/60)/runDist;if(mpk>30||mpk<2)return'--';return mpk.toFixed(1);
}
function hav(a1,o1,a2,o2){var R=6371,dLat=(a2-a1)*Math.PI/180,dLon=(o2-o1)*Math.PI/180;var a=Math.sin(dLat/2)*Math.sin(dLat/2)+Math.cos(a1*Math.PI/180)*Math.cos(a2*Math.PI/180)*Math.sin(dLon/2)*Math.sin(dLon/2);return R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CALORIES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function calcCal(){
  var wt=getWeightKg();var met={warmup:3,run:8,walk:3.5,cooldown:3};var cal=0;
  for(var i=0;i<curIv&&i<ivs.length;i++)cal+=(met[ivs[i][0]]||3)*wt*ivs[i][1]/3600;
  if(curIv<ivs.length){var elapsed=ivs[curIv][1]-secLeft;cal+=(met[ivs[curIv][0]]||3)*wt*elapsed/3600;}
  return Math.round(cal);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FORMATTING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function fmt(s){var m=Math.floor(s/60);var sec=s%60;return m+':'+(sec<10?'0':'')+sec;}
function fmtM(s){if(s<=0)return'0min';var m=Math.floor(s/60);return m<1?s+'s':m+'min';}
function distStr(km){var s=gSet();if(s.units==='mi')return(km*0.621371).toFixed(2)+' mi';return km.toFixed(2)+' km';}
function paceStr(mpk){if(mpk==='--')return'--';var s=gSet();if(s.units==='mi')return(parseFloat(mpk)*1.609).toFixed(1);return mpk;}
function paceUnit(){return gSet().units==='mi'?'min/mi':'min/km';}
function weightUnit(){return gSet().units==='mi'?'lbs':'kg';}
function weightVal(v){return gSet().units==='mi'?(v*2.20462).toFixed(1):v.toFixed(1);}
function distUnit(){return gSet().units==='mi'?'mi':'km';}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFETTI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function fireConfetti(){
  var c=document.getElementById('confetti');var ctx=c.getContext('2d');
  var dpr=window.devicePixelRatio||1;var W=window.innerWidth,H=window.innerHeight;
  c.width=W*dpr;c.height=H*dpr;c.style.width=W+'px';c.style.height=H+'px';ctx.scale(dpr,dpr);
  var particles=[];var colors=['#ff4d2a','#00ccff','#ffb020','#00e676','#9955ff','#ffd740'];
  var count=Math.min(120,Math.max(60,Math.round(W*0.2)));
  for(var i=0;i<count;i++){particles.push({x:Math.random()*W,y:-10,vx:(Math.random()-.5)*8,vy:Math.random()*6+2,size:Math.random()*6+3,color:colors[Math.floor(Math.random()*colors.length)],rotation:Math.random()*360,rotSpeed:(Math.random()-.5)*10,life:1});}
  var frame=0;
  function draw(){ctx.clearRect(0,0,W,H);var alive=false;for(var i=0;i<particles.length;i++){var p=particles[i];p.x+=p.vx;p.y+=p.vy;p.vy+=.15;p.vx*=.99;p.rotation+=p.rotSpeed;p.life-=.006;if(p.life>0){alive=true;ctx.save();ctx.translate(p.x,p.y);ctx.rotate(p.rotation*Math.PI/180);ctx.globalAlpha=p.life;ctx.fillStyle=p.color;ctx.fillRect(-p.size/2,-p.size/2,p.size,p.size);ctx.restore();}}frame++;if(alive&&frame<300)requestAnimationFrame(draw);else ctx.clearRect(0,0,W,H);}
  draw();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateNavIndicator(){
  var runBtn=document.querySelectorAll('.bnav button')[1];
  if(isRun){runBtn.style.color='var(--run)';runBtn.querySelector('.ni').textContent='ğŸ”´';}
  else{if(!runBtn.classList.contains('on'))runBtn.style.color='';runBtn.querySelector('.ni').textContent='â–¶ï¸';}
}
function go(name){
  var scrs=document.querySelectorAll('.scr');for(var i=0;i<scrs.length;i++)scrs[i].classList.remove('on');
  var btns=document.querySelectorAll('.bnav button');for(var i=0;i<btns.length;i++)btns[i].classList.remove('on');
  document.getElementById(name+'-scr').classList.add('on');
  var idx=['plan','timer','progress','body'].indexOf(name);
  if(idx>=0)btns[idx].classList.add('on');
  if(name==='progress')renderProgress();
  if(name==='body')renderBody();
  if(name==='timer'&&!curWO)autoLoad();
  document.getElementById(name+'-scr').scrollTop=0;
}
function autoLoad(){for(var w=0;w<TOTAL_WEEKS;w++)for(var d=0;d<3;d++)if(!isDn(w,d)){loadWO(w,d);return;}loadWO(0,0);}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PLAN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderPlan(){
  // Daily tip
  var tipIdx=Math.floor(Date.now()/(1000*60*60*24))%TIPS.length;
  var tip=TIPS[tipIdx];
  document.getElementById('tip-box').innerHTML='<span class="tip-icon">'+tip.icon+'</span><span>'+tip.t+'</span>';

  // Run schedule indicator
  var s=gSet();var runDays=s.runDays||[1,3,5];
  if(runDays.length>0){
    var dayNames=['Mon','Tue','Wed','Thu','Fri','Sat','Sun'];
    var today=new Date().getDay();var todayIdx=today===0?6:today-1;
    var schedHTML='<div class="sched-bar">';
    for(var i=0;i<7;i++){
      var isRD=runDays.indexOf(i)!==-1;
      var isToday=i===todayIdx;
      schedHTML+='<span class="sched-day'+(isRD?' run':'')+(isToday?' today':'')+'">'+(isToday?'â–¸':'')+dayNames[i]+'</span>';
    }
    schedHTML+='</div>';
    document.getElementById('tip-box').innerHTML+=schedHTML;
  }

  // Quote
  var qi=Math.floor(Date.now()/(1000*60*60*12))%QUOTES.length;
  document.getElementById('quote-box').innerHTML='\u201c'+QUOTES[qi].q+'\u201d<span class="qa">\u2014 '+QUOTES[qi].a+'</span>';

  var st=getStats();
  document.getElementById('streak-num').textContent=st.streak;
  document.getElementById('xp-total').textContent=gXP()+' XP';

  // Week selector
  var sel=document.getElementById('wsel');sel.innerHTML='';
  for(var w=0;w<TOTAL_WEEKS;w++){
    var b=document.createElement('button');
    var isBeyond=w>=9;
    b.className='wk'+(w===selW?' on':'')+(wkDn(w)?' dn':'')+(isBeyond?' beyond':'');
    b.textContent=w+1;b.setAttribute('data-w',w);
    b.onclick=function(){selW=parseInt(this.getAttribute('data-w'));renderPlan();};
    sel.appendChild(b);
  }
  setTimeout(function(){var a=sel.querySelector('.wk.on');if(a)a.scrollIntoView({behavior:'smooth',inline:'center',block:'nearest'});},50);

  var c=document.getElementById('dcds');c.innerHTML='';
  if(selW>=9)c.innerHTML='<div class="section-lbl">ğŸš€ Beyond 5K â€” Bridge to 10K</div>';
  for(var di=0;di<3;di++){
    var day=P[selW][di];var total=0,runT=0,walkT=0;
    for(var j=0;j<day.length;j++){total+=day[j][1];if(day[j][0]==='run')runT+=day[j][1];if(day[j][0]==='walk')walkT+=day[j][1];}
    var done=isDn(selW,di);var cd=document.createElement('div');
    cd.className='dc fu'+(done?' cd':'');cd.style.animationDelay=(di*.07)+'s';
    cd.setAttribute('data-w',selW);cd.setAttribute('data-d',di);
    var bars='';for(var k=0;k<day.length;k++)bars+='<div class="ivb '+day[k][0]+'" style="flex:'+day[k][1]+'"></div>';
    cd.innerHTML='<div class="dt">Day '+(di+1)+'</div><div class="ds">'+NM[selW][di]+'</div><div class="dd"><span class="rv">ğŸƒ '+fmtM(runT)+'</span><span class="wv">ğŸš¶ '+fmtM(walkT)+'</span><span class="tv">â± '+fmt(total)+'</span></div><div class="ivp">'+bars+'</div>';
    cd.onclick=function(){loadWO(parseInt(this.getAttribute('data-w')),parseInt(this.getAttribute('data-d')));go('timer');};
    // Preview button
    var pvBtn=document.createElement('button');
    pvBtn.className='pv-btn';pvBtn.textContent='ğŸ‘ Preview';
    pvBtn.setAttribute('data-w',selW);pvBtn.setAttribute('data-d',di);
    pvBtn.onclick=function(e){e.stopPropagation();showIvModal(parseInt(this.getAttribute('data-w')),parseInt(this.getAttribute('data-d')));};
    cd.appendChild(pvBtn);
    c.appendChild(cd);
  }
  document.getElementById('repeat-btn').style.display=wkDn(selW)?'block':'none';
}

function repeatWeek(){var p=sg('prog',{});for(var d=0;d<3;d++)delete p[selW+'-'+d];ss('prog',p);renderPlan();}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INTERVAL PREVIEW MODAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showIvModal(w,d){
  var day=P[w][d];var html='<h3>Week '+(w+1)+' Â· Day '+(d+1)+'</h3><div class="iv-list">';
  for(var i=0;i<day.length;i++){
    html+='<div class="iv-row"><div class="iv-dot '+day[i][0]+'"></div><div class="iv-type">'+day[i][0]+'</div><div class="iv-dur">'+fmtM(day[i][1])+'</div></div>';
  }
  html+='</div><button class="iv-modal-close" onclick="closeIvModal();loadWO('+w+','+d+');go(\'timer\')">â–¶ Start This Workout</button>';
  document.getElementById('iv-modal-content').innerHTML=html;
  document.getElementById('iv-modal').classList.add('open');
}
function closeIvModal(){document.getElementById('iv-modal').classList.remove('open');}

// Inline interval preview on timer
function toggleIvPreview(){
  ivPreviewOpen=!ivPreviewOpen;
  document.getElementById('iv-list').style.display=ivPreviewOpen?'flex':'none';
  document.getElementById('iv-toggle').textContent=ivPreviewOpen?'â–² Hide intervals':'â–¼ Show intervals';
  if(ivPreviewOpen)renderIvPreview();
}
function renderIvPreview(){
  if(!curWO||!ivPreviewOpen)return;
  var html='';
  for(var i=0;i<ivs.length;i++){
    html+='<div class="iv-item'+(i===curIv?' active':'')+'"><div class="iv-dot '+ivs[i][0]+'"></div><span class="iv-type">'+ivs[i][0]+'</span><span class="iv-dur">'+fmtM(ivs[i][1])+'</span></div>';
  }
  document.getElementById('iv-list').innerHTML=html;
  // Scroll active into view
  var active=document.querySelector('.iv-item.active');
  if(active)active.scrollIntoView({block:'nearest'});
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TIMER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function loadWO(w,d){
  if(tH){clearInterval(tH);tH=null;}
  isRun=false;halfSp=false;lastTickTime=0;paceAlertGiven=false;
  releaseWakeLock();resetGPSState();
  curWO={week:w,day:d};ivs=P[w][d];curIv=0;totEl=0;
  secLeft=ivs[0][1];sCals=0;
  refreshTimer();renderIvPreview();
  document.getElementById('t-coach').textContent='Tap play to start';
}

function refreshTimer(){
  if(!curWO)return;
  var wLabel=curWO.week>=9?'Beyond 5K Â· ':'';
  el('t-label').textContent=wLabel+'Week '+(curWO.week+1)+' \u00b7 Day '+(curWO.day+1);
  var ph=(curIv<ivs.length)?ivs[curIv][0]:'done';
  var pe=el('t-phase');
  if(ph==='done'){pe.textContent='Done!';pe.className='tph done';}
  else if(!isRun&&totEl===0){pe.textContent='Ready';pe.className='tph ready';}
  else{pe.textContent=ph.charAt(0).toUpperCase()+ph.slice(1);pe.className='tph '+ph;}
  el('t-time').textContent=fmt(Math.max(0,secLeft));
  var ne=el('t-next');
  if(curIv<ivs.length-1){var nx=ivs[curIv+1];ne.textContent='Next: '+nx[0]+' '+fmtM(nx[1]);}
  else if(ph==='done')ne.textContent='';
  else ne.textContent='Final interval';

  var ring=el('ring');var iT=(curIv<ivs.length)?ivs[curIv][1]:1;
  ring.setAttribute('stroke-dashoffset',553*(secLeft/iT));
  var cm={run:'var(--run)',walk:'var(--walk)',warmup:'var(--warm)',cooldown:'var(--cool)',done:'var(--done)',ready:'var(--tm)'};
  var gm={run:'var(--rung)',walk:'var(--walkg)',warmup:'var(--warmg)',cooldown:'var(--coolg)',done:'var(--doneg)',ready:'transparent'};
  var dp=(!isRun&&totEl===0)?'ready':ph;
  ring.style.stroke=cm[dp]||cm.ready;ring.style.filter='drop-shadow(0 0 10px '+(gm[dp]||'transparent')+')';

  var tD=0;for(var i=0;i<ivs.length;i++)tD+=ivs[i][1];
  el('tp-el').textContent=fmt(totEl);el('tp-tot').textContent=fmt(tD);
  el('tp-fill').style.width=(tD>0?(totEl/tD)*100:0)+'%';

  sCals=calcCal();cPace=calcCurrentPace();
  var st=gSet();
  var displayDist=treadmillMode?getTreadmillDist():tDist;
  el('ls-cal').textContent=sCals;
  el('ls-pace').textContent=paceStr(cPace);
  el('ll-pace').textContent=treadmillMode?'treadmill':paceUnit();
  el('ls-dist').textContent=st.units==='mi'?(displayDist*0.621371).toFixed(2):displayDist.toFixed(2);
  el('ll-dist').textContent=treadmillMode?distUnit()+' (est)':distUnit();

  var btn=el('btn-play');
  if(curIv>=ivs.length){btn.textContent='\u2713';btn.className='bp ready';}
  else if(isRun){btn.textContent='\u23f8';btn.className='bp playing';}
  else{btn.textContent='\u25b6';btn.className='bp ready';}
  updateNavIndicator();
}

function handlePlay(){
  initA();
  if(!curWO)autoLoad();
  if(curIv>=ivs.length)return;
  isRun=!isRun;
  if(isRun){
    lastTickTime=Date.now();
    snd(ivs[curIv][0]);vPhase(ivs[curIv][0]);
    if(totEl===0)startGPS();else resumeGPS();
    requestWakeLock();
    if(tH)clearInterval(tH);tH=setInterval(tick,1000);
  }else{
    if(tH){clearInterval(tH);tH=null;}
    lastTickTime=0;stopGPS();releaseWakeLock();
  }
  refreshTimer();
}

function tick(){
  lastTickTime=Date.now();secLeft--;totEl++;
  if(curIv<ivs.length&&ivs[curIv][0]==='run')runTimeSec++;

  var tD=0;for(var i=0;i<ivs.length;i++)tD+=ivs[i][1];

  // Halfway alert + turn-around hint
  if(!halfSp&&totEl>=tD/2){
    halfSp=true;
    if(voiceMode==='full'){
      speak("Halfway there! Time to turn around and head back. Keep pushing!");
    }
  }

  // Pace goal check (every 60 seconds during run intervals)
  if(!treadmillMode&&curIv<ivs.length&&ivs[curIv][0]==='run'&&totEl%60===0){
    var goal=gSet().paceGoal;
    if(goal>0&&cPace!=='--'){
      var current=parseFloat(cPace);
      if(current>goal+0.5&&!paceAlertGiven){
        paceAlertGiven=true;
        speak("Pick up the pace! You're running slower than your goal.");
      }else if(current<=goal&&paceAlertGiven){
        paceAlertGiven=false;
        speak("Great pace! You're on target.");
      }
    }
  }

  if(secLeft===10){
    if(curIv<ivs.length-1){snd('tick');var nt=ivs[curIv+1][0];speak('10 seconds. Get ready to '+nt+'.');}
    else{snd('tick');var am=COACH.almost;speak(am[Math.floor(Math.random()*am.length)]);}
  }
  if(secLeft>0&&secLeft<=3)snd('tick');
  if(secLeft<=0){
    curIv++;
    if(curIv<ivs.length){
      secLeft=ivs[curIv][1];snd(ivs[curIv][0]);vPhase(ivs[curIv][0]);
      try{if(navigator.vibrate)navigator.vibrate([100,50,100]);}catch(e){}
      var tip=COACH.tips[ivs[curIv][0]]||'';document.getElementById('t-coach').textContent=tip;
      if(voiceMode==='full'&&tip)setTimeout(function(){speak(tip);},3500);
      renderIvPreview();
    }else{
      if(tH){clearInterval(tH);tH=null;}isRun=false;halfSp=false;lastTickTime=0;
      stopGPS();releaseWakeLock();
      snd('done');vPhase('done');
      try{if(navigator.vibrate)navigator.vibrate([100,50,100,50,200]);}catch(e){}
      sCals=calcCal();
      document.getElementById('t-coach').textContent="You're a champion! ğŸ†";
      showSummary();
    }
  }
  refreshTimer();
}

function skipInterval(){
  if(!isRun||curIv>=ivs.length)return;
  totEl+=(secLeft-1);secLeft=1;tick();
}

function resetTimer(){
  if(tH){clearInterval(tH);tH=null;}
  isRun=false;halfSp=false;lastTickTime=0;paceAlertGiven=false;
  releaseWakeLock();resetGPSState();
  if(curWO){curIv=0;totEl=0;secLeft=ivs[0][1];sCals=0;}
  document.getElementById('t-coach').textContent='Tap play to start';
  refreshTimer();renderIvPreview();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// POST-RUN SUMMARY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showSummary(){
  if(!curWO)return;
  var p=sg('prog',{});
  var avgRunPace=calcAvgRunPace();
  var displayDist=treadmillMode?getTreadmillDist():tDist;
  var displayRunDist=treadmillMode?(displayDist*0.7):runDist; // rough 70% estimate for treadmill
  p[curWO.week+'-'+curWO.day]={cal:sCals,dist:parseFloat(displayDist.toFixed(2)),pace:avgRunPace,runDist:parseFloat(displayRunDist.toFixed(2)),runTime:runTimeSec,date:new Date().toISOString()};
  ss('prog',p);

  var h=sg('history',[]);
  h.unshift({w:curWO.week,d:curWO.day,cal:sCals,dist:parseFloat(displayDist.toFixed(2)),pace:avgRunPace,runDist:parseFloat(displayRunDist.toFixed(2)),runTime:runTimeSec,date:new Date().toLocaleDateString('en-AU',{day:'numeric',month:'short',year:'numeric'})});
  if(h.length>50)h=h.slice(0,50);
  ss('history',h);

  var runMin=0;for(var i=0;i<ivs.length;i++)if(ivs[i][0]==='run')runMin+=ivs[i][1]/60;
  var earned=Math.round(50+runMin*10+(curWO.week*5));
  var oldXP=gXP();ss('xp',oldXP+earned);

  var stats=getStats();var oldBadges=gBadges();var newBadges=[];
  for(var i=0;i<BADGES.length;i++){
    var b=BADGES[i];
    if(oldBadges.indexOf(b.id)===-1&&b.check(stats)){newBadges.push(b);oldBadges.push(b.id);}
  }
  ss('badges',oldBadges);

  var st=gSet();
  document.getElementById('sum-wk').textContent='Week '+(curWO.week+1)+' \u00b7 Day '+(curWO.day+1);
  document.getElementById('sum-quote').textContent='\u201c'+QUOTES[Math.floor(Math.random()*QUOTES.length)].q+'\u201d';

  var tD=0;for(var i=0;i<ivs.length;i++)tD+=ivs[i][1];
  var avgSpeed=displayRunDist>0.01&&runTimeSec>10?(displayRunDist/(runTimeSec/3600)):0;
  var speedVal=st.units==='mi'?(avgSpeed*0.621371).toFixed(1):avgSpeed.toFixed(1);
  var speedLbl=st.units==='mi'?'Run mph':'Run km/h';

  document.getElementById('sum-grid').innerHTML=
    '<div class="sum-card"><div class="sv" style="color:var(--tm)">'+fmt(tD)+'</div><div class="sl">Total Time</div></div>'+
    '<div class="sum-card"><div class="sv" style="color:var(--run)">'+fmt(runTimeSec)+'</div><div class="sl">Run Time</div></div>'+
    '<div class="sum-card"><div class="sv" style="color:var(--done)">'+distStr(displayDist)+'</div><div class="sl">Distance'+(treadmillMode?' (est)':'')+'</div></div>'+
    '<div class="sum-card"><div class="sv" style="color:var(--walk)">'+(treadmillMode?'--':paceStr(avgRunPace))+'</div><div class="sl">Run Pace '+paceUnit()+'</div></div>'+
    '<div class="sum-card"><div class="sv" style="color:var(--warm)">'+sCals+'</div><div class="sl">Calories</div></div>'+
    '<div class="sum-card"><div class="sv" style="color:var(--cool)">'+speedVal+'</div><div class="sl">'+speedLbl+'</div></div>';

  document.getElementById('sum-xp').textContent='+'+earned+' XP';

  var badgeHTML='';
  for(var i=0;i<newBadges.length;i++){
    var nb=newBadges[i];
    badgeHTML+='<div class="sum-badge pop" style="animation-delay:'+(i*.15)+'s"><div class="badge-icon">'+nb.icon+'</div><div class="badge-info"><div class="badge-name">'+nb.name+'</div><div class="badge-desc">'+nb.desc+'</div></div></div>';
  }
  document.getElementById('sum-badges').innerHTML=badgeHTML;

  // Graduation certificate check
  var gradHTML='';
  if(curWO.week===8&&curWO.day===2&&wkDn(8)){
    var gd=new Date().toLocaleDateString('en-AU',{day:'numeric',month:'long',year:'numeric'});
    gradHTML='<div class="grad-cert show"><div class="gc-star">ğŸ“</div><div class="gc-title">Certificate of Completion</div><div class="gc-main">5K Graduate!</div><div class="gc-sub">You completed the Couch to 5K program!</div><div class="gc-stats">'+stats.total+' workouts Â· '+Math.round(stats.cals)+' kcal burned Â· '+distStr(stats.dist)+'</div><div class="gc-date">'+gd+'</div></div>';
  }
  if(curWO.week===13&&curWO.day===2&&wkDn(13)){
    var gd=new Date().toLocaleDateString('en-AU',{day:'numeric',month:'long',year:'numeric'});
    gradHTML='<div class="grad-cert show"><div class="gc-star">ğŸ†</div><div class="gc-title">Certificate of Completion</div><div class="gc-main">10K Ready!</div><div class="gc-sub">You completed the entire Beyond 5K program!</div><div class="gc-stats">'+stats.total+' workouts Â· '+Math.round(stats.cals)+' kcal burned Â· '+distStr(stats.dist)+'</div><div class="gc-date">'+gd+'</div></div>';
  }
  document.getElementById('sum-grad').innerHTML=gradHTML;

  document.getElementById('sum-overlay').classList.add('open');
  setTimeout(fireConfetti,200);
}

function closeSummary(){
  document.getElementById('sum-overlay').classList.remove('open');
  curWO=null;go('plan');renderPlan();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PROGRESS â€” with weekly trend chart
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderProgress(){
  var p=sg('prog',{});var st=gSet();var stats=getStats();
  var totalXP=gXP();var earned=gBadges();
  var lvl=LEVELS[0];var nextLvl=LEVELS[1]||null;
  for(var i=LEVELS.length-1;i>=0;i--){if(totalXP>=LEVELS[i].xp){lvl=LEVELS[i];nextLvl=LEVELS[i+1]||null;break;}}
  var pEl=document.getElementById('progress-scr');
  var html='';
  var lvlPct=nextLvl?((totalXP-lvl.xp)/(nextLvl.xp-lvl.xp)*100):100;
  html+='<div class="lvl-bar"><div class="lvl-icon">'+lvl.icon+'</div><div class="lvl-info"><div class="lvl-name">'+lvl.name+'</div><div class="lvl-sub">'+(nextLvl?'Next: '+nextLvl.name+' ('+nextLvl.xp+' XP)':'Max level!')+'</div><div class="lvl-track"><div class="lvl-fill" style="width:'+Math.min(100,lvlPct)+'%"></div></div></div><div class="lvl-xp">'+totalXP+'</div></div>';
  var totalWO=TOTAL_WEEKS*3;
  var dV=st.units==='mi'?(stats.dist*0.621371).toFixed(1):stats.dist.toFixed(1);
  html+='<div class="srow"><div class="sc"><div class="sv">'+stats.total+'</div><div class="sl">Workouts</div></div><div class="sc"><div class="sv">'+Math.round((stats.total/totalWO)*100)+'%</div><div class="sl">Complete</div></div><div class="sc"><div class="sv" style="color:var(--warm)">'+stats.cals+'</div><div class="sl">Total kcal</div></div><div class="sc"><div class="sv" style="color:var(--walk)">'+dV+'</div><div class="sl">Total '+distUnit()+'</div></div></div>';

  // Weekly distance trend chart
  html+='<div class="trend-chart"><div class="tc-title">Weekly Distance Trend</div><canvas id="trend-canvas"></canvas></div>';

  // Graduation cert display on progress page
  if(wkDn(8)){
    var gd='';
    var lastW8=p['8-2'];if(lastW8&&lastW8.date)gd=new Date(lastW8.date).toLocaleDateString('en-AU',{day:'numeric',month:'long',year:'numeric'});
    html+='<div class="grad-cert show"><div class="gc-star">ğŸ“</div><div class="gc-title">Certificate of Completion</div><div class="gc-main">5K Graduate!</div><div class="gc-sub">Completed the Couch to 5K program</div><div class="gc-date">'+(gd||'')+'</div></div>';
  }
  if(wkDn(13)){
    var lastW13=p['13-2'];var gd='';if(lastW13&&lastW13.date)gd=new Date(lastW13.date).toLocaleDateString('en-AU',{day:'numeric',month:'long',year:'numeric'});
    html+='<div class="grad-cert show"><div class="gc-star">ğŸ†</div><div class="gc-title">Certificate of Completion</div><div class="gc-main">10K Ready!</div><div class="gc-sub">Completed the Beyond 5K program</div><div class="gc-date">'+(gd||'')+'</div></div>';
  }

  html+='<div class="pgrid">';
  for(var w=0;w<TOTAL_WEEKS;w++)for(var d=0;d<3;d++){var dn=p[w+'-'+d]!=null;html+='<div class="pc'+(dn?' dn':'')+'"><div class="pw">W'+(w+1)+'</div><div class="pd">'+(dn?'\u2713':'D'+(d+1))+'</div></div>';}
  html+='</div>';
  html+='<div class="badges-title">Achievements</div><div class="badges-grid">';
  for(var i=0;i<BADGES.length;i++){var b=BADGES[i];var has=earned.indexOf(b.id)!==-1;html+='<div class="badge-cell'+(has?' earned':'')+'"><div class="be">'+(has?b.icon:'ğŸ”’')+'</div><div class="bn">'+b.name+'</div></div>';}
  html+='</div>';
  var hist=sg('history',[]);
  if(hist.length>0){
    html+='<div class="htitle">Recent Workouts</div><div class="hlist">';
    var max=Math.min(hist.length,15);
    for(var i=0;i<max;i++){
      var it=hist[i];
      html+='<div class="hi"><div class="hl">W'+(it.w+1)+'D'+(it.d+1)+' <span style="color:var(--td);font-size:10px;margin-left:5px">'+it.date+'</span></div><div class="hr"><span style="color:var(--warm)">'+(it.cal||0)+'</span><span style="color:var(--done)">'+distStr(it.dist||0)+'</span></div></div>';
    }
    html+='</div>';
  }
  html+='<button class="rbtn" onclick="resetProgress()">Reset All Progress</button>';
  pEl.innerHTML=html;

  // Draw trend chart after DOM update
  setTimeout(drawTrendChart,50);
}

function roundedRect(ctx,x,y,w,h,r){ctx.beginPath();ctx.moveTo(x+r,y);ctx.lineTo(x+w-r,y);ctx.quadraticCurveTo(x+w,y,x+w,y+r);ctx.lineTo(x+w,y+h);ctx.lineTo(x,y+h);ctx.lineTo(x,y+r);ctx.quadraticCurveTo(x,y,x+r,y);ctx.closePath();}

function drawTrendChart(){
  var canvas=document.getElementById('trend-canvas');
  if(!canvas)return;
  var ctx=canvas.getContext('2d');
  var dpr=window.devicePixelRatio||1;
  var rect=canvas.parentElement.getBoundingClientRect();
  if(rect.width<10)return;
  canvas.width=rect.width*dpr;canvas.height=100*dpr;
  canvas.style.width=rect.width+'px';canvas.style.height='100px';
  ctx.scale(dpr,dpr);
  var W=rect.width,H=100;ctx.clearRect(0,0,W,H);

  // Group history by week
  var hist=sg('history',[]);
  if(hist.length<2){ctx.fillStyle='#7c7c9a';ctx.font='11px Outfit, sans-serif';ctx.textAlign='center';ctx.fillText('Complete more workouts to see trends',W/2,H/2);return;}

  var weekMap={};
  for(var i=0;i<hist.length;i++){
    var d=hist[i].date||'';
    // Group by W+D key
    var wk='W'+(hist[i].w+1);
    if(!weekMap[wk])weekMap[wk]={dist:0,cal:0};
    weekMap[wk].dist+=(hist[i].dist||0);
    weekMap[wk].cal+=(hist[i].cal||0);
  }
  var keys=Object.keys(weekMap).reverse().slice(-10); // last 10 weeks
  var isImp=gSet().units==='mi';
  var vals=keys.map(function(k){return isImp?weekMap[k].dist*0.621371:weekMap[k].dist;});
  if(vals.length<2)return;

  var mx=Math.max.apply(null,vals)*1.1||1;
  var pad={t:5,b:20,l:5,r:5};var cW=W-pad.l-pad.r,cH=H-pad.t-pad.b;
  var barW=Math.min(30,(cW/vals.length)*0.7);
  var gap=(cW-barW*vals.length)/(vals.length+1);

  for(var i=0;i<vals.length;i++){
    var x=pad.l+gap+(barW+gap)*i;
    var barH=(vals[i]/mx)*cH;
    var grad=ctx.createLinearGradient(x,pad.t+cH-barH,x,pad.t+cH);
    grad.addColorStop(0,'#00ccff');grad.addColorStop(1,'#00ccff40');
    ctx.fillStyle=grad;
    roundedRect(ctx,x,pad.t+cH-barH,barW,barH,3);ctx.fill();
    ctx.fillStyle='#7c7c9a';ctx.font='8px JetBrains Mono, monospace';ctx.textAlign='center';
    ctx.fillText(keys[i],x+barW/2,H-3);
    if(vals[i]>0){ctx.fillStyle='#eeeef4';ctx.fillText(vals[i].toFixed(1),x+barW/2,pad.t+cH-barH-4);}
  }
}

function resetProgress(){if(confirm('Reset all workout progress, XP, and badges? Weight logs will be kept.\n\nThis cannot be undone.')){try{localStorage.removeItem('c25k_prog');localStorage.removeItem('c25k_history');localStorage.removeItem('c25k_xp');localStorage.removeItem('c25k_badges');}catch(e){}selW=0;renderProgress();renderPlan();}}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BODY / WEIGHT + BMI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateWeightUI(){
  var u=gSet().units;var inp=document.getElementById('wt-in');
  if(u==='mi'){inp.placeholder='Enter weight (lbs)';inp.max='700';}
  else{inp.placeholder='Enter weight (kg)';inp.max='300';}
}

function calcBMI(){
  var logs=sg('wlogs',[]);
  var hM=getHeightM();
  if(hM<0.5||logs.length===0)return null;
  var lastKg=logs[logs.length-1].w;
  var bmi=lastKg/(hM*hM);
  return{val:bmi.toFixed(1),kg:lastKg,hM:hM};
}

function renderBMI(){
  var sec=document.getElementById('bmi-section');
  var s=gSet();var h=s.height||0;
  if(!h||h<50){sec.innerHTML='<div class="bmi-card"><div class="bmi-title">BMI</div><div style="font-size:11px;color:var(--td)">Set your height in Settings to see BMI</div></div>';return;}
  var bmi=calcBMI();
  if(!bmi){sec.innerHTML='';return;}
  var v=parseFloat(bmi.val);
  var col,lbl;
  if(v<18.5){col='var(--walk)';lbl='Underweight';}
  else if(v<25){col='var(--done)';lbl='Healthy';}
  else if(v<30){col='var(--warm)';lbl='Overweight';}
  else{col='var(--run)';lbl='Obese';}
  var pct=Math.min(100,Math.max(0,((v-15)/25)*100));
  sec.innerHTML='<div class="bmi-card"><div class="bmi-title">BMI</div><div class="bmi-row"><div class="bmi-val" style="color:'+col+'">'+bmi.val+'</div><div class="bmi-label" style="color:'+col+';background:'+col+'20">'+lbl+'</div></div><div class="bmi-bar"><div style="position:absolute;left:0;right:0;top:0;bottom:0;border-radius:3px;background:linear-gradient(90deg,var(--walk),var(--done),var(--warm),var(--run))"></div><div class="bmi-bar-fill" style="left:calc('+pct+'% - 5px);background:'+col+'"></div></div><div class="bmi-scale"><span>15</span><span>18.5</span><span>25</span><span>30</span><span>40</span></div></div>';
}

function logWeight(){
  var v=parseFloat(document.getElementById('wt-in').value);
  var isImp=gSet().units==='mi';
  var minW=isImp?40:20,maxW=isImp?700:320;
  if(!v||v<minW||v>maxW){alert('Enter a weight between '+minW+' and '+maxW+' '+(isImp?'lbs':'kg'));return;}
  var kg=isImp?v*0.453592:v;
  var logs=sg('wlogs',[]);
  logs.push({w:kg,d:new Date().toISOString().split('T')[0],ts:Date.now()});
  ss('wlogs',logs);
  document.getElementById('wt-in').value='';
  renderBody();
}

function deleteWeight(idx){
  if(!confirm('Delete this weight entry?'))return;
  var logs=sg('wlogs',[]);logs.splice(idx,1);ss('wlogs',logs);renderBody();
}

function renderBody(){
  updateWeightUI();renderBMI();
  var logs=sg('wlogs',[]);var wu=weightUnit();
  document.getElementById('wt-nodata').style.display=logs.length>0?'none':'flex';
  var sum=document.getElementById('wt-summary');
  if(logs.length>0){
    var first=logs[0].w,last=logs[logs.length-1].w,diff=last-first;
    var col=diff<=0?'var(--done)':'var(--run)';
    var fV=weightVal(first),lV=weightVal(last),dV=gSet().units==='mi'?(diff*2.20462).toFixed(1):diff.toFixed(1);
    sum.innerHTML='<div class="ws"><div class="wsv" style="color:var(--tm)">'+fV+'</div><div class="wsl">Start '+wu+'</div></div><div class="ws"><div class="wsv">'+lV+'</div><div class="wsl">Current '+wu+'</div></div><div class="ws"><div class="wsv" style="color:'+col+'">'+(diff>0?'+':'')+dV+'</div><div class="wsl">Change '+wu+'</div></div>';
  }else{sum.innerHTML='';}
  drawChart(logs);
  var logEl=document.getElementById('wt-log');
  var titleEl=document.getElementById('wt-log-title');
  if(logs.length>0){
    titleEl.style.display='block';
    var html='';var show=logs.slice().reverse().slice(0,15);
    for(var i=0;i<show.length;i++){
      var realIdx=logs.length-1-i;
      html+='<div class="wt-entry"><span class="we-date">'+show[i].d+'</span><span class="we-val">'+weightVal(show[i].w)+' '+wu+'</span><button class="we-del" onclick="deleteWeight('+realIdx+')">âœ•</button></div>';
    }
    logEl.innerHTML=html;
  }else{titleEl.style.display='none';logEl.innerHTML='';}
}

function drawChart(logs){
  var canvas=document.getElementById('wt-canvas');
  if(!canvas)return;var ctx=canvas.getContext('2d');
  var dpr=window.devicePixelRatio||1;var rect=canvas.parentElement.getBoundingClientRect();
  if(rect.width<10)return;
  canvas.width=rect.width*dpr;canvas.height=150*dpr;
  canvas.style.width=rect.width+'px';canvas.style.height='150px';
  ctx.scale(dpr,dpr);var W=rect.width,H=150;ctx.clearRect(0,0,W,H);
  if(logs.length<2)return;
  var isImp=gSet().units==='mi';
  var vals=logs.map(function(l){return isImp?l.w*2.20462:l.w;});
  var mn=Math.min.apply(null,vals)-1;var mx=Math.max.apply(null,vals)+1;if(mx===mn)mx=mn+2;
  var pad={t:10,b:25,l:40,r:10};var cW=W-pad.l-pad.r,cH=H-pad.t-pad.b;
  ctx.strokeStyle='#2a2a3d';ctx.lineWidth=.5;
  for(var i=0;i<=4;i++){
    var y=pad.t+cH*(i/4);
    ctx.beginPath();ctx.moveTo(pad.l,y);ctx.lineTo(W-pad.r,y);ctx.stroke();
    ctx.fillStyle='#7c7c9a';ctx.font='10px JetBrains Mono, monospace';ctx.textAlign='right';
    ctx.fillText((mx-(mx-mn)*(i/4)).toFixed(1),pad.l-5,y+3);
  }
  ctx.beginPath();ctx.strokeStyle='#00ccff';ctx.lineWidth=2;ctx.lineJoin='round';
  for(var i=0;i<vals.length;i++){
    var x=pad.l+(i/(vals.length-1))*cW;var y=pad.t+cH*(1-(vals[i]-mn)/(mx-mn));
    if(i===0)ctx.moveTo(x,y);else ctx.lineTo(x,y);
  }
  ctx.stroke();
  var grad=ctx.createLinearGradient(0,pad.t,0,H-pad.b);
  grad.addColorStop(0,'rgba(0,204,255,0.2)');grad.addColorStop(1,'rgba(0,204,255,0)');
  ctx.lineTo(pad.l+(vals.length-1)/(vals.length-1)*cW,H-pad.b);
  ctx.lineTo(pad.l,H-pad.b);ctx.closePath();ctx.fillStyle=grad;ctx.fill();
  for(var i=0;i<vals.length;i++){
    var x=pad.l+(i/(vals.length-1))*cW;var y=pad.t+cH*(1-(vals[i]-mn)/(mx-mn));
    ctx.beginPath();ctx.arc(x,y,3,0,Math.PI*2);ctx.fillStyle='#00ccff';ctx.fill();
  }
}

var resizeTimer=null;
window.addEventListener('resize',function(){clearTimeout(resizeTimer);resizeTimer=setTimeout(function(){if(document.getElementById('body-scr').classList.contains('on'))renderBody();},200);});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SETTINGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openSettings(){
  var s=gSet();
  document.getElementById('s-wt').value=s.weight||70;
  document.getElementById('s-ht').value=s.height||170;
  document.getElementById('s-un').value=s.units||'km';
  document.getElementById('s-vc').value=s.voice||'full';
  document.getElementById('s-pace').value=s.paceGoal||'';
  document.getElementById('s-remind').value=s.remindTime||'07:00';
  updateSettingsLabels(s.units||'km');
  // Run days
  var days=s.runDays||[1,3,5];
  var btns=document.querySelectorAll('#day-sel button');
  for(var i=0;i<btns.length;i++)btns[i].classList.toggle('on',days.indexOf(i)!==-1);
  document.getElementById('set-mo').classList.add('open');
  document.getElementById('s-un').onchange=function(){updateSettingsLabels(this.value);};
}
function updateSettingsLabels(u){
  document.getElementById('lbl-wt').textContent='Weight ('+(u==='mi'?'lbs':'kg')+')';
  document.getElementById('lbl-ht').textContent='Height ('+(u==='mi'?'inches':'cm')+')';
  document.getElementById('lbl-pace').textContent='Pace Goal ('+(u==='mi'?'min/mi':'min/km')+')';
}
function toggleDay(btn,idx){btn.classList.toggle('on');}
function closeSettings(){document.getElementById('set-mo').classList.remove('open');}
function saveSettings(){
  var oldUnits=gSet().units;var newUnits=document.getElementById('s-un').value;
  var weightVal=parseFloat(document.getElementById('s-wt').value)||70;
  var heightVal=parseFloat(document.getElementById('s-ht').value)||170;
  if(oldUnits!==newUnits){
    if(oldUnits==='km'&&newUnits==='mi'){weightVal=Math.round(weightVal*2.20462);heightVal=Math.round(heightVal/2.54);}
    else if(oldUnits==='mi'&&newUnits==='km'){weightVal=Math.round(weightVal*0.453592);heightVal=Math.round(heightVal*2.54);}
  }
  var runDays=[];
  var btns=document.querySelectorAll('#day-sel button');
  for(var i=0;i<btns.length;i++)if(btns[i].classList.contains('on'))runDays.push(i);
  var s={weight:weightVal,height:heightVal,units:newUnits,voice:document.getElementById('s-vc').value,paceGoal:parseFloat(document.getElementById('s-pace').value)||0,runDays:runDays,remindTime:document.getElementById('s-remind').value};
  ss('settings',s);voiceMode=s.voice;voiceOn=s.voice!=='off';
  document.getElementById('voice-btn').classList.toggle('on',voiceOn);
  closeSettings();refreshTimer();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// REMINDERS (Notification API)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function enableReminders(){
  if(!('Notification' in window)){alert('Notifications not supported in this browser');return;}
  Notification.requestPermission().then(function(perm){
    if(perm==='granted'){
      document.getElementById('remind-status').textContent='âœ… Reminders enabled! You\'ll get notified on run days.';
      scheduleReminder();
    }else{document.getElementById('remind-status').textContent='âŒ Permission denied. Enable in browser settings.';}
  });
}
function scheduleReminder(){
  // Simple approach: check every 60s if it's time
  setInterval(function(){
    var s=gSet();var now=new Date();
    var dayIdx=now.getDay()===0?6:now.getDay()-1; // 0=Mon
    if((s.runDays||[]).indexOf(dayIdx)===-1)return;
    var time=(s.remindTime||'07:00').split(':');
    if(now.getHours()===parseInt(time[0])&&now.getMinutes()===parseInt(time[1])){
      var lastRemind=sg('lastRemind','');
      var today=now.toISOString().split('T')[0];
      if(lastRemind!==today){
        ss('lastRemind',today);
        new Notification('ğŸƒ Time to run!',{body:'Your C25K workout is waiting. Lace up!',icon:'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y="80" font-size="80">ğŸƒ</text></svg>'});
      }
    }
  },60000);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATA EXPORT / IMPORT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function exportData(){
  var data={};
  var keys=['prog','history','xp','badges','settings','wlogs'];
  for(var i=0;i<keys.length;i++)data[keys[i]]=sg(keys[i],null);
  data._exported=new Date().toISOString();
  data._version='c25k-v5';
  var blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
  var a=document.createElement('a');a.href=URL.createObjectURL(blob);
  a.download='c25k-backup-'+new Date().toISOString().split('T')[0]+'.json';
  a.click();URL.revokeObjectURL(a.href);
}

function importData(input){
  var file=input.files[0];if(!file)return;
  var reader=new FileReader();
  reader.onload=function(e){
    try{
      var data=JSON.parse(e.target.result);
      if(!data._version){alert('Invalid backup file');return;}
      if(!confirm('This will overwrite all current data. Continue?'))return;
      var keys=['prog','history','xp','badges','settings','wlogs'];
      for(var i=0;i<keys.length;i++){
        if(data[keys[i]]!=null)ss(keys[i],data[keys[i]]);
      }
      alert('Data restored! Reloading...');
      location.reload();
    }catch(err){alert('Error reading file: '+err.message);}
  };
  reader.readAsText(file);
  input.value='';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function(){
  var s=gSet();voiceMode=s.voice||'full';voiceOn=voiceMode!=='off';
  document.getElementById('voice-btn').classList.toggle('on',voiceOn);
  updateWeightUI();
  renderPlan();
  // Start reminder check if permission already granted
  if('Notification' in window&&Notification.permission==='granted')scheduleReminder();
  // Register service worker for offline support
  if('serviceWorker' in navigator){navigator.serviceWorker.register('sw.js').catch(function(){});}
})();
</script>
</body>
</html>
